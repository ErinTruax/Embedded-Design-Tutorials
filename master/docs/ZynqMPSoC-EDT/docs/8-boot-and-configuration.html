


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="../../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../../_static/js/header-footer.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../../_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all/resources/imgs/header/xilinx-header-logo.svg" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search"
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a>
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="../../_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search"
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Embedded Design Tutorials
          

          
          </a>

          
            
            
              <div class="version">
                2020.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/Embedded-Design-Tutorials/tree/master">Master</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../../_sources/ZynqMPSoC-EDT/docs/8-boot-and-configuration.md.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Embedded Design Tutorials</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Boot and Configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/ZynqMPSoC-EDT/docs/8-boot-and-configuration.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p align="right">
            Read this page in other languages:<a href="../docs-jp/6-boot-and-configuration.md">日本語</a>    <table style="width:100%"><table style="width:100%">
  <tr><th width="100%" colspan="6"><img src="https://www.xilinx.com/content/dam/xilinx/imgs/press/media-kits/corporate/xilinx-logo.png" width="30%"/><h1>Zync UltraScale+ MPSoC Embedded Design Tutorial 2020.2 (UG1209)</h1>
</th>  </tr>
  <tr>
    <td width="17%" align="center"><a href="../README.md">1. Introduction</a></td>
    <td width="16%" align="center"><a href="2-getting-started.md">2. Getting Started</a></td>
    <td width="17%" align="center"><a href="3-system-configuration.md">3. Zynq UltraScale+ MPSoC System Configuration</a></td>
    <td width="17%" align="center"><a href="4-build-sw-for-ps-subsystems.md">4. Build Software for PS Subsystems</a></td>
</tr>
<tr>
    <td width="17%" align="center"><a href="5-build-linux-sw-for-ps.md">5. Building Linux Applications for PS</a></td>
    <td width="16%" align="center"><a href="6-debugging-with-vitis-debugger.md">6. Debugging Standalone Applications</a></td>
    <td width="17%" align="center"><a href="7-debugging-linux-app.md">7. Debugging Linux Applications</a></td>
    <td width="17%" align="center"><a href="8-boot-and-configuration.md">8. Boot and Configuration</a></td>    
  </tr>
</table><ul class="simple">
<li><p><a class="reference external" href="#boot-and-configuration">Boot and Configuration</a></p>
<ul>
<li><p><a class="reference external" href="#system-software">System Software</a></p>
<ul>
<li><p><a class="reference external" href="#first-stage-boot-loader">First Stage Boot Loader</a></p></li>
<li><p><a class="reference external" href="#platform-management-unit-firmware">Platform Management Unit Firmware</a></p></li>
<li><p><a class="reference external" href="#u-boot">U-Boot</a></p></li>
<li><p><a class="reference external" href="#arm-trusted-firmware">Arm Trusted Firmware</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#linux-on-apu-and-bare-metal-on-rpu">Linux on APU and Bare-Metal on RPU</a></p></li>
<li><p><a class="reference external" href="#boot-sequence-for-sd-boot">Boot Sequence for SD-Boot</a></p>
<ul>
<li><p><a class="reference external" href="#running-the-image-on-the-zcu102-board">Running the Image on the ZCU102 Board</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#boot-sequence-for-qspi-boot-mode">Boot Sequence for QSPI Boot Mode</a></p>
<ul>
<li><p><a class="reference external" href="#running-the-image-in-qspi-boot-mode-on-zcu102-board">Running the Image in QSPI Boot Mode on ZCU102 Board</a></p>
<ul>
<li><p><a class="reference external" href="#set-up-the-zcu102-board">Set Up the ZCU102 Board</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#boot-sequence-for-qspi-boot-mode-using-jtag">Boot Sequence for QSPI-Boot Mode Using JTAG</a></p>
<ul>
<li><p><a class="reference external" href="#setting-up-the-target">Setting Up the Target</a></p></li>
<li><p><a class="reference external" href="#load-u-boot-using-xsctxsdb">Load U-Boot Using XSCT/XSDB</a></p></li>
<li><p><a class="reference external" href="#load-bootbin-in-ddr-using-xsdb">Load Boot.bin in DDR Using XSDB</a></p></li>
<li><p><a class="reference external" href="#load-the-bootbin-image-in-qspi-using-u-boot">Load the Boot.bin Image in QSPI Using U-Boot</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#boot-sequence-for-usb-boot-mode">Boot Sequence for USB Boot Mode</a></p>
<ul>
<li><p><a class="reference external" href="#configure-fsbl-to-enable-usb-boot-mode">Configure FSBL to Enable USB Boot Mode</a></p>
<ul>
<li><p><a class="reference external" href="#create-first-stage-boot-loader-for-usb-boot">Create First Stage Boot Loader for USB Boot</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#creating-boot-images-for-usb-boot">Creating Boot Images for USB Boot</a></p>
<ul>
<li><p><a class="reference external" href="#modifying-petalinux-u-boot">Modifying PetaLinux U-Boot</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#boot-using-usb-boot">Boot using USB Boot</a></p>
<ul>
<li><p><a class="reference external" href="#boot-commands-for-linux-host-machine">Boot Commands for Linux Host Machine</a></p></li>
<li><p><a class="reference external" href="#boot-commands-for-windows-host-machine">Boot Commands for Windows Host Machine</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="section" id="boot-and-configuration">
<h1>Boot and Configuration<a class="headerlink" href="#boot-and-configuration" title="Permalink to this headline">¶</a></h1>
<p>This chapter shows integration of components to create a Zynq®
UltraScale+™ system. The purpose of this chapter is to understand how
to integrate and load boot loaders, bare-metal applications (for
APU/RPU), and Linux Operating System for a Zynq UltraScale+ system.</p>
<p>The following important points are covered in this chapter:</p>
<ul class="simple">
<li><p>System Software: FSBL, U-Boot, Arm® trusted firmware (ATF)</p></li>
<li><p>Application Processing Unit (APU): Configure SMP Linux for APU</p></li>
<li><p>Real-time Processing Unit (RPU): Configure Bare-metal for RPU in
Lock-step</p></li>
<li><p>Create Boot Image for the following boot sequence:</p>
<ol class="simple">
<li><p>APU</p></li>
<li><p>RPU Lock-step</p></li>
</ol>
</li>
<li><p>Create and load Secure Boot Image</p></li>
</ul>
<blockquote>
<div><p><strong><em>Note</em>:</strong> For more information on RPU Lock-step, see <em>Zynq
UltraScale+ Device Technical Reference Manual</em> (<a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/ndoc?t=user_guides%3Bd%3Dug1085-zynq-ultrascale-trm.pdf">UG1085</a>).</p>
</div></blockquote>
<p>This boot sequence also includes loading the PMU Firmware for the
Platform Management Unit (PMU). The Vitis IDE and PetaLinux can be
used to create boot images to fulfill different boot requirements.
While <a class="reference internal" href="4-build-sw-for-ps-subsystems.html"><span class="doc">Build Software for PS Subsystems</span></a>
focused only on creating software blocks for each processing unit in
the PS, this chapter explains how these blocks can be loaded as a part
of a bigger system.</p>
<p>To create a boot image, use the Create Boot Image wizard (Bootgen
command line tool). The principle function of the Create Boot Image
wizard or Bootgen is to integrate the partitions (hardware-bitstream
and software) and allow you to specify the security options in the
design. It can also create cryptographic keys. Functionally, Bootgen
uses a Bootgen Image Format (BIF) file as an input, and generates a
single file image in binary BIN or MCS format. Bootgen outputs a
single file image which is loaded into NVM (QSPI, SD Card). The
Bootgen GUI facilitates the creation of the BIF input file.</p>
<p>This chapter makes use of a processing system block. <a class="reference external" href="7-system-design-examples.md#design-example-1-using-gpios-timers-and-interrupts">Design Example 1: Using GPIOs, Timers, and Interrupts</a>
covers boot image which will include the PS partitions used in this
chapter and a bitstream targeted for PL fabric.</p>
<div class="section" id="system-software">
<h2>System Software<a class="headerlink" href="#system-software" title="Permalink to this headline">¶</a></h2>
<p>The following system software blocks cover most of the Boot and
Configuration for this chapter. For detailed boot flow and various
Boot sequences, refer to the “System Boot and Configuration” chapter
in the <em>Zynq UltraScale+ MPSoC: Software Developers Guide</em>
(<a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/rdoc?v=latest%3Bd%3Dug1137-zynq-ultrascale-mpsoc-swdev.pdf">UG1137</a>).</p>
<div class="section" id="first-stage-boot-loader">
<h3>First Stage Boot Loader<a class="headerlink" href="#first-stage-boot-loader" title="Permalink to this headline">¶</a></h3>
<p>In non-secure boot mode, the platform management unit (PMU) releases
the reset of the configuration security unit, and enters the PMU
server mode to monitor power. At this stage the configuration security
unit loads the first stage boot loader (FSBL) into on-chip memory
(OCM). The FSBL can be run from either APU A53_0 or RPU R5_0 or RPU
R5_lockstep. In this example, the FSBL is targeted for APU Cortex™-A53
Core 0. The last 512 bytes of this region is used by FSBL to share the
hand-off parameters corresponding to applications which ATF hands off.</p>
<p>The First Stage Boot Loader initializes important blocks in the
processing subsystem. This includes clearing the reset of the
processors, initializing clocks, memory, UART, and so on before
handing over the control of the next partition in DDR, to either RPU
or APU. In this example, the FSBL loads bare-metal application in DDR
and hands off to RPU Cortex-R5F in Lockstep mode, and similarly loads
U-Boot to be executed by APU Cortex-A53 Core-0. For more information,
see the <em>Zynq UltraScale+ MPSoC: Software Developers Guide</em>
(<a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/rdoc?v=latest%3Bd%3Dug1137-zynq-ultrascale-mpsoc-swdev.pdf">UG1137</a>).</p>
<p>For this chapter, you can use the FSBL executable that you created in
<a class="reference internal" href="4-build-sw-for-ps-subsystems.html"><span class="doc">Build Software for PS Subsystems</span></a>. In FSBL application, the
xfsbl_translation_table.S differs from translation_table.S (of
Cortex-A53) in only one aspect, to mark DDR region as reserved. This
is to avoid speculative access to DDR before it is initialized. Once
the DDR initialization is done in FSBL, memory attributes for DDR
region is changed to “Memory” so that it is cacheable.</p>
</div>
<div class="section" id="platform-management-unit-firmware">
<h3>Platform Management Unit Firmware<a class="headerlink" href="#platform-management-unit-firmware" title="Permalink to this headline">¶</a></h3>
<p>The platform management unit (PMU) and the configuration security unit
manage and perform the multi-staged booting process. The PMU primarily
controls the pre-configuration stage that executes PMU ROM to set up
the system. The PMU handles all of the processes related to reset and
wake-up. The Vitis IDE provides PMU Firmware that can be built to run
on the PMU. For more details on the Platform Management and PMU
Firmware, see the <em>Zynq UltraScale+ MPSoC: Software Developers Guide</em>
(<a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/rdoc?v=latest%3Bd%3Dug1137-zynq-ultrascale-mpsoc-swdev.pdf">UG1137</a>).</p>
<p>The PMU Firmware can be loaded in the following ways:</p>
<ol class="simple">
<li><p>Using BootROM to load PMU Firmware, as described in <a class="reference external" href="#boot-sequence-for-sd-boot">Boot Sequence for SD-Boot</a>.</p></li>
<li><p>Using FSBL to load PMU Firmware, as described in <a class="reference external" href="#boot-sequence-for-qspi-boot-mode">Boot Sequence for QSPI Boot Mode</a>.</p></li>
<li><p>Loading PMU Firmware in JTAG boot mode, as described in <a class="reference external" href="#boot-sequence-for-qspi-boot-mode-using-jtag">Boot Sequence for QSPI-Boot Mode Using JTAG</a>.</p></li>
</ol>
<p>For more information, see the <a class="reference external" href="http://www.wiki.xilinx.com/PMU%2BFirmware">PMU Firmware Xilinx
Wiki</a>.</p>
</div>
<div class="section" id="u-boot">
<h3>U-Boot<a class="headerlink" href="#u-boot" title="Permalink to this headline">¶</a></h3>
<p>The U-Boot acts as a secondary boot loader. After the FSBL handoff,
the U-Boot loads Linux on Arm® Cortex-A53 APU. After FSBL, the U-Boot
configures the rest of the peripherals in the processing system based
on board configuration. U-Boot can fetch images from different memory
sources like eMMC, SATA, TFTP, SD, and QSPI. For this example, U-Boot
and all other images are loaded from the SD card. Therefore, for this
example, the board will be set to SD-boot mode.</p>
<p>U-Boot can be configured and built using the PetaLinux tool flow. For
this example, you can use the U-Boot image that you created in
<a class="reference internal" href="4-build-sw-for-ps-subsystems.html"><span class="doc">Build Software for PS Subsystems</span></a> or from the
design files shared with this document. See <a class="reference external" href="2-getting-started.md#design-files-for-this-tutorial">Design Files for This Tutorial</a> for information about
downloading the design files for this tutorial.</p>
</div>
<div class="section" id="arm-trusted-firmware">
<h3>Arm Trusted Firmware<a class="headerlink" href="#arm-trusted-firmware" title="Permalink to this headline">¶</a></h3>
<p>The Arm Trusted Firmware (ATF) is a transparent bare-metal application
layer executed in Exception Level 3 (EL3) on APU. The ATF includes a
Secure Monitor layer for switching between secure and non-secure
world. The Secure Monitor calls and implementation of Trusted Board
Boot Requirements (TBBR) makes the ATF layer a mandatory requirement
to load Linux on APU on Zynq UltraScale+.</p>
<p>The FSBL loads ATF to be executed by APU, which keeps running in EL3
awaiting a service request. The ATF starts at 0xFFFEA000. The FSBL
also loads U-Boot in DDR to be executed by APU, which loads Linux OS
in SMP mode on APU. It is important to note that the PL bitstream
should be loaded before ATF is loaded. The reason is FSBL uses the OCM
region which is reserved for ATF for holding a temporary buffer in the
case where bitstream is present in .BIN file. Because of this, if
bitstream is loaded after ATF, FSBL will overwrite the ATF image with
its temporary buffer, corrupting ATF image. Hence, bitstream should be
positioned in .BIF before ATF and preferably immediately after FSBL
and PMU Firmware.</p>
<p>The ATF (<code class="docutils literal notranslate"><span class="pre">bl31.elf</span></code>) is built by default in PetaLinux and can be found
in the PetaLinux Project images directory.</p>
<p>For more details on ATF, refer to the “Arm Trusted Firmware” section
in the “Security” chapter of the <em>Zynq UltraScale+ MPSoC: Software
Developers Guide</em>
(<a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/rdoc?v=latest%3Bd%3Dug1137-zynq-ultrascale-mpsoc-swdev.pdf">UG1137</a>).</p>
</div>
</div>
<div class="section" id="linux-on-apu-and-bare-metal-on-rpu">
<h2>Linux on APU and Bare-Metal on RPU<a class="headerlink" href="#linux-on-apu-and-bare-metal-on-rpu" title="Permalink to this headline">¶</a></h2>
<p>Now that the system software is configured, create Linux Images using
PetaLinux tool flow. You already created the PetaLinux images in
<a class="reference internal" href="4-build-sw-for-ps-subsystems.html"><span class="doc">Build Software for PS Subsystems</span></a>. For this
example, the PetaLinux is configured to build images for SD-boot. This
is the default boot setting in PetaLinux.</p>
<p>The images can be found in the <code class="docutils literal notranslate"><span class="pre">$&lt;PetaLinux_Project&gt;/images/linux/</span></code> directory. For loading Linux on APU, the following images will be used from PetaLinux:</p>
<ul class="simple">
<li><p>ATF - <code class="docutils literal notranslate"><span class="pre">bl31.elf</span></code></p></li>
<li><p>U-Boot - <code class="docutils literal notranslate"><span class="pre">u-boot.elf</span></code></p></li>
<li><p>Linux images - <code class="docutils literal notranslate"><span class="pre">image.ub</span></code>, which contains:</p>
<ul>
<li><p>Kernel image</p></li>
<li><p>Device Tree <code class="docutils literal notranslate"><span class="pre">system.dtb</span></code></p></li>
<li><p>File system <code class="docutils literal notranslate"><span class="pre">rootfs.cpio.gz.u-boot</span></code></p></li>
</ul>
</li>
</ul>
<p>In addition to Linux on APU, this example also loads a bare-metal
Application on RPU Cortex- R5F in Lockstep mode.</p>
<p>For this example, refer the testapp_r5 application that you created in
<a class="reference external" href="4-build-sw-for-ps-subsystems.md#create-custom-bare-metal-application-for-arm-cortex-r5-based-rpu">Create Custom Bare-Metal Application for Arm Cortex-R5 based RPU</a>.</p>
<p>Alternatively, you can also find the testapp_r5.elf executable in the
design files that accompany this tutorial. See <a class="reference external" href="2-getting-started.md#design-files-for-this-tutorial">Design Files for This Tutorial</a> for information about
downloading the design files for this tutorial.</p>
</div>
<div class="section" id="boot-sequence-for-sd-boot">
<h2>Boot Sequence for SD-Boot<a class="headerlink" href="#boot-sequence-for-sd-boot" title="Permalink to this headline">¶</a></h2>
<p>Now that all the individual images are ready, create the boot image to
load all of these components on Zynq UltraScale+. This can be done
using the Create Boot Image wizard in the Vitis IDE, using the
following steps:</p>
<ol>
<li><p>In the Vitis IDE, select <strong>Xilinx → Create Boot Image</strong>.</p></li>
<li><p>Select all the partitions referred in earlier sections in this
chapter, and set them as shown in the following figure.</p>
<p><img alt="../../_images/image551.png" src="../../_images/image551.png" /></p>
</li>
<li><p>First, add the FSBL partition.</p>
<ol class="simple">
<li><p>In the Create Boot Image wizard, click <strong>Add</strong> to open the Add partition view.</p></li>
<li><p>In the Add Partition view, click <strong>Browse</strong> to select the FSBL executable.</p></li>
<li><p>For FSBL, ensure that the partition type is selected as boot loader and the correct destination CPU is selected by the tool. The tool is configured to make this selection based on the FSBL executable.</p></li>
</ol>
<blockquote>
<div><p><strong><em>Note</em>:</strong> Ignore the Exception Level drop down, as FSBL is set to
EL3 by default. Also, leave the TrustZone setting unselected for this
example.</p>
</div></blockquote>
<p><img alt="../../_images/image56.png" src="../../_images/image56.png" /></p>
<ol class="simple">
<li><p>Click <strong>OK</strong> to select FSBL and go back to Create Boot Image wizard.</p></li>
</ol>
</li>
<li><p>Next, add the PMU and ATF firmware partitions.</p>
<ol>
<li><p>Click <strong>Add</strong> to open the Add Partition view, shown in the
following figure.</p>
<p><img alt="../../_images/image571.png" src="../../_images/image571.png" /></p>
</li>
<li><p>Add the PMU firmware partition.</p>
<ol class="simple">
<li><p>Browse to and select the <strong>PMU Firmware executable</strong>.</p></li>
<li><p>For this partition, select <strong>pmu</strong> as the partition type.</p></li>
</ol>
</li>
<li><p>Leave the Exception Level and TrustZone settings unselected.</p></li>
<li><p>Click <strong>OK</strong>.</p></li>
<li><p>Click <strong>Add</strong> to open Add Partition view.</p></li>
<li><p>Add the ATF firmware <code class="docutils literal notranslate"><span class="pre">bl31.elf</span></code> partition.</p>
<blockquote>
<div><p><strong><em>Note</em>:</strong> ATF Firmware (<code class="docutils literal notranslate"><span class="pre">bl31.elf</span></code>) can be found in <code class="docutils literal notranslate"><span class="pre">&lt;PetaLinux</span> <span class="pre">Project&gt;/image/linux/</span></code>. Alternatively, you can also use <code class="docutils literal notranslate"><span class="pre">bl31.elf</span></code> from
<a class="reference external" href="2-getting-started.md#design-files-for-this-tutorial">Design Files for This Tutorial</a>.</p>
</div></blockquote>
<ol class="simple">
<li><p>For this partition, select <strong>datafile</strong> as the partition type.</p></li>
<li><p>Set the Destination Device as <strong>PS</strong>.</p></li>
<li><p>Set the Destination CPU as <strong>A53 0</strong>.</p></li>
<li><p>Set the Exception Level to EL3 and select <strong>Enable TrustZone</strong>.</p></li>
</ol>
<p><img alt="../../_images/image58.png" src="../../_images/image58.png" /></p>
</li>
<li><p>Click <strong>OK</strong>.</p></li>
</ol>
</li>
<li><p>Next, add the R5 executable and enable it in lockstep mode.</p>
<ol>
<li><p>Click <strong>Add</strong> to add the Cortex-R5F bare-metal executable.</p>
<p><img alt="../../_images/image59.png" src="../../_images/image59.png" /></p>
</li>
<li><p>Set the Destination Device as <strong>PS</strong>.</p></li>
<li><p>Set the Destination CPU as <strong>R5 Lockstep</strong>. This sets the RPU R5 cores to run in Lockstep mode.</p></li>
<li><p>Leave Exception Level and TrustZone unselected.</p></li>
<li><p>Click <strong>OK</strong>.</p></li>
</ol>
</li>
<li><p>Now, add the U-Boot partition. You can find <code class="docutils literal notranslate"><span class="pre">u-boot.elf</span></code> for sd_boot mode in <code class="docutils literal notranslate"><span class="pre">&lt;PetaLinux_project&gt;/images/linux/sd_boot</span></code>.</p>
<ol>
<li><p>Click <strong>Add</strong> to add the u-boot.elf partition.</p></li>
<li><p>For U-Boot, select the Destination Device as <strong>PS</strong>.</p></li>
<li><p>Select the Destination CPU as <strong>A53 0</strong>.</p></li>
<li><p>Set the Exception Level to <strong>EL2</strong>.</p>
<p><img alt="../../_images/image602.png" src="../../_images/image602.png" /></p>
</li>
<li><p>Click <strong>OK</strong> to return to the Create Boot Image wizard.</p></li>
<li><p>Click <strong>Create Image</strong> to close the wizard and create the boot
image.</p></li>
</ol>
</li>
</ol>
<p>You can also create <code class="docutils literal notranslate"><span class="pre">BOOT.bin</span></code> images using the BIF attributes and the
Bootgen command. For this configuration, the BIF file contains
following attributes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">arch</span> <span class="o">=</span> <span class="n">zynqmp</span><span class="p">;</span> <span class="n">split</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span> <span class="nb">format</span> <span class="o">=</span> <span class="n">BIN</span>
<span class="n">the_ROM_image</span><span class="p">:</span>
<span class="p">{</span>
<span class="p">[</span><span class="n">bootloader</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">fsbl_a53</span>\<span class="n">Debug</span>\<span class="n">fsbl_a53</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">pmufw_image</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">edt_zcu102_wrapper</span>\<span class="n">export</span>\<span class="n">edt_zcu102_wrapper</span>\<span class="n">sw</span>\<span class="n">edt_zcu102_wrapper</span>\<span class="n">boot</span>\<span class="n">pmufw</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">trustzone</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">sd_boot</span>\<span class="n">bl31</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">r5</span><span class="o">-</span><span class="n">lockstep</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">testapp_r5</span>\<span class="n">Debug</span>\<span class="n">testapp_r5</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">sd_boot</span>\<span class="n">u</span><span class="o">-</span><span class="n">boot</span><span class="o">.</span><span class="n">elf</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The Vitis IDE calls the following Bootgen command to generate the
BOOT.bin image for this configuration:</p>
<p><code class="docutils literal notranslate"><span class="pre">bootgen</span> <span class="pre">-image</span> <span class="pre">sd_boot.bif</span> <span class="pre">-arch</span> <span class="pre">zynqmp</span> <span class="pre">-o</span> <span class="pre">C:\edt\sd_boot\BOOT.bi</span></code>n</p>
<div class="section" id="running-the-image-on-the-zcu102-board">
<h3>Running the Image on the ZCU102 Board<a class="headerlink" href="#running-the-image-on-the-zcu102-board" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>Copy the <code class="docutils literal notranslate"><span class="pre">BOOT.bin</span></code>, <code class="docutils literal notranslate"><span class="pre">image.ub</span></code>, and <code class="docutils literal notranslate"><span class="pre">boot.scr</span></code> to the SD card. Here
<code class="docutils literal notranslate"><span class="pre">boot.scr</span></code> is read by U-Boot to load kernel and the root file
system.</p></li>
<li><p>Load the SD card into the ZCU102 board, in the J100 connector.</p></li>
<li><p>Connect a micro USB cable from ZCU102 board USB UART port (J83) to
the USB port on the host machine.</p></li>
<li><p>Configure the board to boot in the
SD-boot mode by setting switch SW6 to 1-ON, 2-OFF, 3- OFF, and
4-OFF, as shown in following figure.</p>
<p><img alt="../../_images/image432.jpeg" src="../../_images/image432.jpeg" /></p>
</li>
<li><p>Connect 12V Power to the ZCU102 6-Pin Molex connector.</p></li>
<li><p>Start a terminal session, using Tera Term or Minicom depending on
the host machine being used, as well as the COM port and baud rate
for your system, as shown in following figure.</p>
<p><img alt="../../_images/image44.png" src="../../_images/image44.png" /></p>
</li>
<li><p>For port settings, verify COM port in device manager. There are four
USB-UART interfaces exposed by the ZCU102 board.</p></li>
<li><p>Select the COM port associated with the interface with the lowest
number. In this case, for UART-0, select the COM port with
interface-0.</p></li>
<li><p>Similarly, for UART-1, select COM port with interface-1. Remember
that the R5 BSP has been configured to use UART-1, and so R5
application messages appear on the COM port with the UART-1
terminal.</p></li>
<li><p>Turn on the ZCU102 Board using SW1, and wait until Linux loads on
the board. At this point, you can see the initial boot sequence
messages on your terminal screen representing UART-0.</p>
<p>You can see that the terminal screen configured for UART-1 also prints
a message. This is the print message from the R5 bare-metal
application running on RPU, configured to use UART-1 interface. This
application is loaded by the FSBL onto RPU.</p>
<p>The bare-metal application has been modified to include the UART
interrupt example. This application now waits in the waiting for
interrupt (WFI) state until a user input is encountered from the
keyboard in UART-1 terminal.</p>
<p><img alt="../../_images/image61.png" src="../../_images/image61.png" /></p>
<p>Meanwhile, the boot sequence continues on APU and the images loaded
can be understood from the messages appearing on the UART-0 terminal.
The messages are highlighted in the following figure.</p>
<p>The U-Boot then loads Linux kernel and other images on Arm Cortex-A53
APU in SMP mode. The terminal messages indicate when the U-Boot loads
the kernel image and the kernel start up to getting a user interface
prompt in Target Linux OS. The kernel loading and starting sequence
can be seen in the following figure.</p>
<p><img alt="../../_images/image632.png" src="../../_images/image632.png" /></p>
</li>
</ol>
</div>
</div>
<div class="section" id="boot-sequence-for-qspi-boot-mode">
<h2>Boot Sequence for QSPI Boot Mode<a class="headerlink" href="#boot-sequence-for-qspi-boot-mode" title="Permalink to this headline">¶</a></h2>
<p>The ZCU102 board also comes with dual parallel QSPI flashes adding up
to 128 MB size. In this example, you will create a boot image and load
the images on Zynq UltraScale+ in QSPI boot mode. The images can be
configured using the Create Boot Image wizard in the Vitis IDE. This
can be done by doing the following steps.</p>
<blockquote>
<div><p><strong><em>Note</em>:</strong> This section assumes that you have created PetaLinux
Images for QSPI Boot mode by following steps from <a class="reference external" href="4-build-sw-for-ps-subsystems.md#create-linux-images-using-petalinux-for-qspi-flash">Create Linux Images
Using PetaLinux for QSPI Flash</a>.</p>
</div></blockquote>
<ol>
<li><p>If the Vitis IDE is not already running, start it and set the
workspace as indicated in <a class="reference internal" href="4-build-sw-for-ps-subsystems.html"><span class="doc">Build Software for PS Subsystems</span></a>.</p></li>
<li><p>Select <strong>Xilinx → Create Boot Image</strong>.</p></li>
<li><p>Select <strong>Zynq MP</strong> as the Architecture.</p></li>
<li><p>Select the <strong>Create new BIF</strong> file option.</p></li>
<li><p>Ensure that the Output format is set to BIN.</p></li>
<li><p>In the Basic page, browse to and
select the <strong>Output BIF</strong> file path and output path.</p>
<p><img alt="../../_images/image641.png" src="../../_images/image641.png" /></p>
</li>
<li><p>Next, add boot partitions using the following steps:</p>
<ol>
<li><p>Click <strong>Add</strong> to open the Add Partition view.</p></li>
<li><p>In the Add Partition view, click the <strong>Browse</strong> button to select
the <strong>FSBL executable</strong>.</p>
<ol>
<li><p>For FSBL, ensure that the
Partition type is selected as boot loader and the correct
destination CPU is selected by the tool. The tool is
configured to make this selection based on the FSBL
executable.</p>
<p><img alt="../../_images/image652.jpeg" src="../../_images/image652.jpeg" /></p>
</li>
<li><p>Ignore the Exception Level, as FSBL is set to EL3 by
default. Also, leave the TrustZone setting unselected for
this example.</p></li>
<li><p>Click <strong>OK</strong> to select the FSBL and go back to the Create
Boot Image wizard.</p></li>
</ol>
</li>
<li><p>Click <strong>Add</strong> to open the Add Partition window to add the next
partition.</p></li>
<li><p>The next partition is the PMU firmware for the Platform
Management Unit.</p>
<ol>
<li><p>Select the Partition type as <strong>datafile</strong> and the
Destination Device as <strong>PS</strong>.</p></li>
<li><p>Select <strong>PMU</strong> for Destination CPU.</p></li>
<li><p>Click <strong>OK</strong>.</p>
<p><img alt="../../_images/image661.png" src="../../_images/image661.png" /></p>
</li>
</ol>
</li>
<li><p>The next partition to be added is the ATF firmware. For this, set
the Partition type to datafile.</p>
<ol>
<li><p>The ATF executable bl31.elf can be found in the PetaLinux images
folder
<code class="docutils literal notranslate"><span class="pre">&lt;PetaLinux_project\/images/linux/</span></code>.</p></li>
<li><p>Select the Destination Device as <strong>PS</strong> and the Destination CPU as
A53 0.</p></li>
<li><p>Set the Exception Level to EL3 and
select Enable TrustZone.</p>
<p><img alt="../../_images/image67.png" src="../../_images/image67.png" /></p>
</li>
<li><p>Click <strong>OK</strong>.</p></li>
</ol>
</li>
<li><p>Click <strong>Add</strong> to add the R5 bare-metal executable.</p>
<ol>
<li><p>Add the R5 executable and enable it in lockstep mode, as shown
in the following image.</p></li>
<li><p>Click <strong>OK</strong>.</p>
<p><img alt="../../_images/image681.jpeg" src="../../_images/image681.jpeg" /></p>
</li>
</ol>
</li>
<li><p>Click <strong>Add</strong> to add the U-Boot partition. u-boot.elf can be found in <code class="docutils literal notranslate"><span class="pre">&lt;PetaLinux_Project&gt;/images/linux/</span></code>.</p>
<ol>
<li><p>For U-Boot, make the following selections:</p>
<ul class="simple">
<li><p>Set the Partition Type to <strong>datafile</strong>.</p></li>
<li><p>Set the Destination Device to <strong>PS</strong>.</p></li>
<li><p>Set the Destination CPU to <strong>A53 0</strong>.</p></li>
<li><p>Set the Exception Level to <strong>EL2</strong>.</p></li>
</ul>
<p><img alt="ZynqMPSoC-EDT\docs\./media/image69.png" src="ZynqMPSoC-EDT\docs\./media/image69.png" /></p>
</li>
<li><p>Click <strong>OK</strong>.</p></li>
</ol>
</li>
<li><p>Click <strong>Add</strong> to add the image.ub Linux image file.</p>
<ol class="simple">
<li><p>The image.ub image file can be found in PetaLinux project in the
<code class="docutils literal notranslate"><span class="pre">images/Linux</span></code> directory.</p></li>
<li><p>For image.ub, make the following selections:</p>
<ul class="simple">
<li><p>Set Partition Type to <strong>datafile</strong>.</p></li>
<li><p>Set the Destination Device to <strong>PS</strong>.</p></li>
<li><p>Set the Destination CPU to <strong>A53 0</strong>.</p></li>
</ul>
</li>
<li><p>Enter <code class="docutils literal notranslate"><span class="pre">0xF00000</span></code> as the offset.</p></li>
<li><p>Leave Exception Level and TrustZone unselected.</p></li>
</ol>
<p><strong><em>Note</em>:</strong> See <a class="reference external" href="4-build-sw-for-ps-subsystems.md#create-linux-images-using-petalinux-for-qspi-flash">Create Linux Images Using PetaLinux for QSPI Flash</a>, to
understand the offset value.</p>
</li>
<li><p>Click <strong>Add</strong> to add the <code class="docutils literal notranslate"><span class="pre">boot.scr</span></code> script file.</p>
<ol class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">boot.scr</span></code> file is located in the images/linux directory of
the PetaLinux project.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">boot.scr</span></code>, select the following:</p>
<ul class="simple">
<li><p>Set partition type to <strong>datafile</strong>.</p></li>
<li><p>Set the Destination Device to <strong>PS</strong>.</p></li>
<li><p>Set the Destination CPU to <strong>A53 0</strong>.</p></li>
</ul>
</li>
<li><p>Enter 0x3e80000 as the offset.</p></li>
<li><p>Leave Exception Level and TrustZone unselected.</p></li>
</ol>
<p><img alt="ZynqMPSoC-EDT\docs\./media/image70.png" src="ZynqMPSoC-EDT\docs\./media/image70.png" /></p>
</li>
</ol>
</li>
<li><p>Click <strong>OK</strong> to go back to Create Boot Image wizard.</p></li>
<li><p>Click <strong>Create Image</strong> to create the <code class="docutils literal notranslate"><span class="pre">qspi_BOOT.bin</span></code> image.</p></li>
</ol>
<p>You can also create qspi_BOOT.bin images using the BIF attributes and
the Bootgen command. You can view the BIF attributes for this
configuration by clicking <strong>Preview BIF Changes</strong>. For this
configuration, the BIF file contains following attributes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">arch</span> <span class="o">=</span> <span class="n">zynqmp</span><span class="p">;</span> <span class="n">split</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span> <span class="nb">format</span> <span class="o">=</span> <span class="n">BIN</span>
<span class="n">the_ROM_image</span><span class="p">:</span>
<span class="p">{</span>
<span class="p">[</span><span class="n">bootloader</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">fsbl_a53</span>\<span class="n">Debug</span>\<span class="n">fsbl_a53</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">pmu</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">edt_zcu102_wrapper</span>\<span class="n">export</span>\<span class="n">edt_zcu102_wrapper</span>\<span class="n">sw</span>\<span class="n">edt_zcu102_wrapper</span>\<span class="n">boot</span>\<span class="n">pmufw</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">trustzone</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">qspi_boot</span>\<span class="n">bl31</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">r5</span><span class="o">-</span><span class="n">lockstep</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">testapp_r5</span>\<span class="n">Debug</span>\<span class="n">testapp_r5</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">qspi_boot</span>\<span class="n">u</span><span class="o">-</span><span class="n">boot</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">offset</span> <span class="o">=</span> <span class="mh">0xF00000</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">qspi_boot</span>\<span class="n">image</span><span class="o">.</span><span class="n">ub</span>
<span class="p">[</span><span class="n">offset</span> <span class="o">=</span> <span class="mh">0x3e80000</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">qspi_boot</span>\<span class="n">boot</span><span class="o">.</span><span class="n">scr</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The Vitis IDE calls the following Bootgen command to generate the
qspi_BOOT.bin image for this configuration.</p>
<p><code class="docutils literal notranslate"><span class="pre">bootgen</span> <span class="pre">-image</span> <span class="pre">qspi_boot.bif</span> <span class="pre">-arch</span> <span class="pre">zynqmp</span> <span class="pre">-o</span> <span class="pre">C:\edt\qspi_BOOT.bin</span></code></p>
<blockquote>
<div><p><strong><em>Note</em>:</strong> In this boot sequence, the First Stage Boot Loader (FSBL)
loads PMU firmware. This is because the PMU firmware was added as a
datafile partition type. Ideally, the Boot ROM code can load the PMU
Firmware for PMU as witnessed in the earlier section. For more details
on PMU Firmware, refer to the “Platform Management” chapter in the
<em>Zynq UltraScale+ MPSoC: Software Developers Guide</em>
(<a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/rdoc?v=latest%3Bd%3Dug1137-zynq-ultrascale-mpsoc-swdev.pdf">UG1137</a>).</p>
</div></blockquote>
<div class="section" id="running-the-image-in-qspi-boot-mode-on-zcu102-board">
<h3>Running the Image in QSPI Boot Mode on ZCU102 Board<a class="headerlink" href="#running-the-image-in-qspi-boot-mode-on-zcu102-board" title="Permalink to this headline">¶</a></h3>
<p>To test the image in this example, you will load the Boot image
(qspi_BOOT.bin) onto QSPI on the ZCU102 board using the Program Flash
utility in the Vitis IDE. Alternately, you can use the XSDB debugger.</p>
<ol>
<li><p>In the Vitis IDE, select <strong>Xilinx → Program Flash</strong>.</p></li>
<li><p>In the Program Flash wizard, browse to and select the <code class="docutils literal notranslate"><span class="pre">qspi_BOOT.bin</span></code>
image file that was created as a part of this example.</p></li>
<li><p>Select <strong>qspi-x8-dual_parallel</strong> as the Flash type.</p></li>
<li><p>Set the Offset as <strong>0</strong> and select the <strong>FSBL ELF file (fsbl_a53.elf)</strong></p></li>
<li><p>Ensure that a USB cable is connected between the USB-JTAG connector on ZCU102 target and the USB port on the host machine using the following steps.</p>
<ol class="simple">
<li><p>Set the SW6 Boot mode switch as shown in the following figure.</p></li>
<li><p>Turn on the board.</p></li>
</ol>
<p><img alt="../../_images/image26.jpeg" src="../../_images/image26.jpeg" /></p>
</li>
<li><p>Click <strong>Program</strong> to start the process of programming the QSPI Flash
with the qspi_BOOT.bin</p>
<p><img alt="ZynqMPSoC-EDT\docs\./media/image71.jpeg" src="ZynqMPSoC-EDT\docs\./media/image71.jpeg" /></p>
<p>Wait until you see the message “Flash Operation Successful” in the
console, as shown in the following image.</p>
<p><img alt="ZynqMPSoC-EDT\docs\./media/image72.png" src="ZynqMPSoC-EDT\docs\./media/image72.png" /></p>
</li>
</ol>
<div class="section" id="set-up-the-zcu102-board">
<h4>Set Up the ZCU102 Board<a class="headerlink" href="#set-up-the-zcu102-board" title="Permalink to this headline">¶</a></h4>
<ol>
<li><p>Connect Board USB-UART on Board to Host machine. Connect the Micro
USB cable into the ZCU102 Board Micro USB port J83, and the other
end into an open USB port on the host machine.</p></li>
<li><p>Configure the Board to Boot in QSPI-Boot mode by switching SW6 as
shown in following figure.</p>
<p><img alt="ZynqMPSoC-EDT\docs\./media/image73.jpeg" src="ZynqMPSoC-EDT\docs\./media/image73.jpeg" /></p>
</li>
<li><p>Connect 12V Power to the ZCU102 6-Pin Molex connector.</p></li>
<li><p>Start a terminal session, using Tera Term or Mini com, depending on
the host machine being used, and the COM port and baud rate as
shown in the following figure.</p></li>
<li><p>For port settings, verify the COM port in the device manager. There
are four USB UART interfaces exposed by the ZCU102.</p></li>
<li><p>Select the COM port associated with the interface with the lowest
number. In this case, for UART-0, select the COM port with
interface-0.</p></li>
<li><p>Similarly, for UART-1, select COM port with interface-1.</p>
<p>Remember, R5 BSP has been configured to use UART-1, so R5 application
messages will appear on the COM port with UART-1 terminal.</p>
<p><img alt="../../_images/image44.png" src="../../_images/image44.png" /></p>
</li>
<li><p>Turn on the ZCU102 Board using SW1.</p>
<p>At this point, you can see initial Boot sequence messages on your
Terminal Screen representing UART-0.</p>
<p>You can see that the terminal screen configured for UART-1 also prints
a message. This is the print message from the R-5 bare-metal
Application running on RPU, configured to use</p>
<p>UART-1 interface. This application is loaded by the FSBL onto RPU.</p>
<p>The bare-metal application has been modified to include the UART
interrupt example. This application now waits in the WFI state until a
user input is encountered from the keyboard in UART-1 terminal.</p>
<p><img alt="../../_images/image61.png" src="../../_images/image61.png" /></p>
<p>Meanwhile, the boot sequence continues on APU and the images loaded
can be understood from the messages appearing on the UART-0 terminal.
The messages are highlighted in the following figure.</p>
<p><img alt="ZynqMPSoC-EDT\docs\./media/image74.png" src="ZynqMPSoC-EDT\docs\./media/image74.png" /></p>
<p>The U-Boot then loads Linux Kernel and other images on Arm Cortex-A53
APU in SMP mode. The terminal messages indicate when U-Boot loads
Kernel image and the kernel start up to getting a user interface
prompt in Linux Kernel. The Kernel loading and starting sequence can
be seen in following figure.</p>
<p><img alt="../../_images/image632.png" src="../../_images/image632.png" /></p>
</li>
</ol>
</div>
</div>
</div>
<div class="section" id="boot-sequence-for-qspi-boot-mode-using-jtag">
<h2>Boot Sequence for QSPI-Boot Mode Using JTAG<a class="headerlink" href="#boot-sequence-for-qspi-boot-mode-using-jtag" title="Permalink to this headline">¶</a></h2>
<p>Zynq UltraScale+ MPSoC supports many methods to load the boot image.
One way is using the JTAG interface. This example XSCT session
demonstrates how to download a boot image file (<code class="docutils literal notranslate"><span class="pre">qspi_BOOT.bin</span></code>) in QSPI
using the XSDB debugger. After the QSPI is loaded, the <code class="docutils literal notranslate"><span class="pre">qspi_BOOT.bin</span></code>
image executes in the same way as QSPI boot mode in Zynq UltraScale+ MPSoC. You can use the same XSCT session or the System Debugger for debugging similar boot flows.</p>
<p>The following sections demonstrate the basic steps involved in this
boot mode.</p>
<div class="section" id="setting-up-the-target">
<h3>Setting Up the Target<a class="headerlink" href="#setting-up-the-target" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>Connect a USB cable between the USB-JTAG J2 connector on the target
and the USB port on the host machine.</p></li>
<li><p>Set the board to JTAG Boot mode by setting the SW6 switch, as shown in the following figure.</p>
<p><img alt="../../_images/image26.jpeg" src="../../_images/image26.jpeg" /></p>
</li>
<li><p>Power on the board using switch SW1. Open the XSCT console in the
Vitis IDE by clicking the XSCT button. Alternatively, you can also
open the XSCT console by selecting <strong>Xilinx → XSCT Console</strong>.</p></li>
<li><p>In the XSCT console, connect to the target over JTAG using the
connect command:</p>
<p><code class="docutils literal notranslate"><span class="pre">xsct%</span> <span class="pre">connect</span></code></p>
<p>The connect command returns the channel ID of the connection.</p>
</li>
<li><p>The targets command lists the available targets and allows you to
select a target using its ID. The targets are assigned IDs as they
are discovered on the JTAG chain, so the IDs can change from
session to session.</p>
<blockquote>
<div><p><strong><em>Note</em>:</strong> For non-interactive usage such as scripting, you can use
the -filter option to select a target instead of selecting the target
using its ID.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">xsct%</span> <span class="pre">targets</span></code></p>
<p>The targets are listed as shown in the following figure.</p>
<p><img alt="ZynqMPSoC-EDT\docs\./media/image75.png" src="ZynqMPSoC-EDT\docs\./media/image75.png" /></p>
</li>
</ol>
</div>
<div class="section" id="load-u-boot-using-xsct-xsdb">
<h3>Load U-Boot Using XSCT/XSDB<a class="headerlink" href="#load-u-boot-using-xsct-xsdb" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>Download the U-Boot application on Cortex-A53 #0 using the
following commands:</p>
<p>By default, JTAG Security gates are enabled. Disable the security
gates for DAP, PL TAP, and PMU (this will make PMU MB target visible
to Debugger).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xsct</span><span class="o">%</span> <span class="n">targets</span> <span class="o">-</span><span class="nb">set</span> <span class="o">-</span><span class="nb">filter</span> <span class="p">{</span><span class="n">name</span> <span class="o">=~</span> <span class="s2">&quot;PSU&quot;</span><span class="p">}</span>
<span class="n">xsct</span><span class="o">%</span> <span class="n">mwr</span> <span class="mh">0xffca0038</span> <span class="mh">0x1ff</span>
<span class="n">xsct</span><span class="o">%</span> <span class="n">targets</span>
</pre></div>
</div>
<p>Verify if the PMU MB target is listed under the PMU device. Now, load
and run PMU Firmware.</p>
<p>Now, reset APU Cortex-A53 Core 0 to load and run FSBL.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xsct</span><span class="o">%</span> <span class="n">targets</span> <span class="o">-</span><span class="nb">set</span> <span class="o">-</span><span class="nb">filter</span> <span class="p">{</span><span class="n">name</span> <span class="o">=~</span> <span class="s2">&quot;Cortex-A53 #0&quot;</span><span class="p">}</span>
<span class="n">xsct</span><span class="o">%</span> <span class="n">rst</span> <span class="o">-</span><span class="n">processor</span>
</pre></div>
</div>
<blockquote>
<div><p><strong><em>Note</em>:</strong> <code class="docutils literal notranslate"><span class="pre">rst</span> <span class="pre">-processor</span></code> clears the reset on an individual processor
core.</p>
</div></blockquote>
<p>This step is important, because when Zynq UltraScale+ MPSoC boots up
in JTAG boot mode, all the APU and RPU cores are held in reset. You
must clear resets on each core before performing debugging on these
cores. You can use therst command in XSCT to clear the resets.</p>
<blockquote>
<div><p><strong><em>Note</em>:</strong> <code class="docutils literal notranslate"><span class="pre">rst</span> <span class="pre">-cores</span></code> clears resets on all the processor cores in the
group (such as APU or RPU) of which the current target is a child. For
example, when A53 #0 is the current target, <code class="docutils literal notranslate"><span class="pre">rst</span> <span class="pre">-cores</span></code> clears resets
on all the Cortex-A53 cores in APU.</p>
</div></blockquote>
<p>Load and run FSBL.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xsct</span><span class="o">%</span> <span class="n">dow</span> <span class="p">{</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">fsbl_a53</span>\<span class="n">Debug</span>\<span class="n">fsbl_a53</span><span class="o">.</span><span class="n">elf</span><span class="p">}</span>
<span class="n">xsct</span><span class="o">%</span> <span class="n">con</span>
</pre></div>
</div>
<p>Verify FSBL messages on Serial Terminal and stop FSBL after couple of
seconds.</p>
<p><code class="docutils literal notranslate"><span class="pre">xsct%</span> <span class="pre">stop</span></code></p>
<p>Load and run ATF.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xsct</span><span class="o">%</span> <span class="n">dow</span> <span class="p">{</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">qspi_boot</span>\<span class="n">bl31</span><span class="o">.</span><span class="n">elf</span><span class="p">}</span>
<span class="n">xsct</span><span class="o">%</span> <span class="n">con</span>
<span class="n">xsct</span><span class="o">%</span> <span class="n">stop</span>
</pre></div>
</div>
</li>
<li><p>Configure a serial terminal (Tera Term, Mini com, or the Serial
Terminal interface for UART-0 USB-serial connection).</p></li>
<li><p>For serial terminal settings, see the following figure.</p>
<p><img alt="ZynqMPSoC-EDT\docs\./media/image76.png" src="ZynqMPSoC-EDT\docs\./media/image76.png" /></p>
</li>
<li><p>Load and run U-Boot.</p>
<p><code class="docutils literal notranslate"><span class="pre">xsct%</span> <span class="pre">dow</span> <span class="pre">{C:\edt\qspi_boot\u-boot.elf}</span></code></p>
</li>
<li><p>Run U-Boot, using the con command in XSDB.</p>
<p><code class="docutils literal notranslate"><span class="pre">xsct%</span> <span class="pre">con</span></code></p>
</li>
<li><p>In the target serial terminal, press any key to stop the U-Boot auto boot.</p></li>
<li><p>Stop the core using the stop command in XSDB.</p>
<p><code class="docutils literal notranslate"><span class="pre">xsct%</span> <span class="pre">stop</span></code></p>
</li>
</ol>
</div>
<div class="section" id="load-boot-bin-in-ddr-using-xsdb">
<h3>Load Boot.bin in DDR Using XSDB<a class="headerlink" href="#load-boot-bin-in-ddr-using-xsdb" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>Download the Boot.bin binary into DDR on ZCU102. Use the same
Boot.bin created for QSPI boot mode.</p>
<p><code class="docutils literal notranslate"><span class="pre">xsct%</span> <span class="pre">dow</span> <span class="pre">-data</span> <span class="pre">{C:\edt\qspi_boot\qspi_BOOT.bin}</span> <span class="pre">0x2000000</span></code></p>
</li>
<li><p>Now continue the U-Boot again, using the con command in XSDB.</p>
<p><code class="docutils literal notranslate"><span class="pre">xsct%</span> <span class="pre">con</span></code></p>
</li>
</ol>
</div>
<div class="section" id="load-the-boot-bin-image-in-qspi-using-u-boot">
<h3>Load the Boot.bin Image in QSPI Using U-Boot<a class="headerlink" href="#load-the-boot-bin-image-in-qspi-using-u-boot" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>Execute the following commands in the U-Boot console on the target
terminal. These commands erase QSPI and then write the Boot.bin
image from DDR to QSPI.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ZynqMP</span><span class="o">&gt;</span> <span class="n">sf</span> <span class="n">probe</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="n">ZynqMP</span><span class="o">&gt;</span> <span class="n">sf</span> <span class="n">erase</span> <span class="mi">0</span> <span class="mh">0x4000000</span>
<span class="n">ZynqMP</span><span class="o">&gt;</span> <span class="n">sf</span> <span class="n">write</span> <span class="mh">0x2000000</span> <span class="mi">0</span> <span class="mh">0x4000000</span>
</pre></div>
</div>
</li>
<li><p>After successfully writing the image to QSPI, turn off the board and
set up the ZCU102 board as described in <a class="reference external" href="#set-up-the-zcu102-board">Set Up the ZCU102 Board</a>.</p>
<p>You can see Linux loading on the UART-0 terminal and the R5
application executing in the UART-1 terminal.</p>
<p>This chapter focused mostly on system boot and different components
related to system boot. In the next chapter, you will focus on
applications, Linux, and Standalone (bare-metal) applications which
will make use of PS peripherals, PL IPs, and processing power of APU
Cores and RPU cores.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="boot-sequence-for-usb-boot-mode">
<h2>Boot Sequence for USB Boot Mode<a class="headerlink" href="#boot-sequence-for-usb-boot-mode" title="Permalink to this headline">¶</a></h2>
<p>Zynq UltraScale+ MPSoC also supports USB Slave Boot Mode. This is
using the USB DFU Device Firmware Upgrade (DFU) Device Class
Specification of USB. Using a standard update utility such as
<a class="reference external" href="http://dfu-util.sourceforge.net/releases/">OpenMoko’s DFU-Util</a>, you
will be able to load the newly created image on</p>
<p>Zynq UltraScale+ MPSoC using the USB Port. The following steps list
the required configuration to load boot images using this boot mode.
The DFU Utility is also shipped with the Vitis unified software
platform and PetaLinux.</p>
<div class="section" id="configure-fsbl-to-enable-usb-boot-mode">
<h3>Configure FSBL to Enable USB Boot Mode<a class="headerlink" href="#configure-fsbl-to-enable-usb-boot-mode" title="Permalink to this headline">¶</a></h3>
<p>There are few changes required in FSBL to enable USB Boot Mode. USB
boot mode support increases the footprint of FSBL (by approximately 10
KB). Because it is intended mostly during the initial development
phase, its support is disabled by default to conserve OCM space. In
this section, you will modify the FSBL to enable the USB Boot Mode.
Considering the FSBL project is used extensively throughout this
tutorial, do not modify the existing FSBL project. Instead, this
section will make use of new FSBL project.</p>
<div class="section" id="create-first-stage-boot-loader-for-usb-boot">
<h4>Create First Stage Boot Loader for USB Boot<a class="headerlink" href="#create-first-stage-boot-loader-for-usb-boot" title="Permalink to this headline">¶</a></h4>
<ol>
<li><p>In the Vitis IDE, select <strong>File→ New → Application Project</strong> to open
the New Project wizard.</p></li>
<li><p>Use the information in the table below to make your selections in
the wizard.</p>
<p><em>Table 9:</em>  <strong>Wizard Properties and Commands</strong></p>
</li>
</ol>
<table border="1" class="docutils">
<thead>
<tr>
<th>Wizard Screen</th>
<th>System Properties</th>
<th>Settings</th>
</tr>
</thead>
<tbody>
<tr>
<td>Platform</td>
<td>Select platform from repository</td>
<td>edt_zcu102_wrapper</td>
</tr>
<tr>
<td>Application project details</td>
<td>Application project name</td>
<td>fsbl_usb_boot</td>
</tr>
<tr>
<td></td>
<td>System project name</td>
<td>fsbl_usb_boot_system</td>
</tr>
<tr>
<td></td>
<td>Target processor</td>
<td>psu_cortexa53_0</td>
</tr>
<tr>
<td>Domain</td>
<td>Domain</td>
<td>standalone on psu_cortexa53_0</td>
</tr>
<tr>
<td>Templates</td>
<td>Available templates</td>
<td>Zynq MP FSBL</td>
</tr>
</tbody>
</table><ol>
<li><p>Click <strong>Finish</strong>.</p></li>
<li><p>In the Explorer view, expand the fsbl_usb_boot project and open
<code class="docutils literal notranslate"><span class="pre">xfsbl_config.h</span></code> from <strong>fsbl_usb_boot→ src→xfsbl_config.h</strong>.</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">xfsbl_config.h</span></code> change or set following settings:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#define FSBL_QSPI_EXCLUDE_VAL (1U)</span>
<span class="c1">#define FSBL_SD_EXCLUDE_VAL (1U)</span>
<span class="c1">#define FSBL_USB_EXCLUDE_VAL (0U)</span>
</pre></div>
</div>
</li>
<li><p>Use <strong>CTRL + S</strong> to save these changes.</p></li>
<li><p>Build FSBL (fsbl_usb_boot).</p></li>
</ol>
</div>
</div>
<div class="section" id="creating-boot-images-for-usb-boot">
<h3>Creating Boot Images for USB Boot<a class="headerlink" href="#creating-boot-images-for-usb-boot" title="Permalink to this headline">¶</a></h3>
<p>In this section, you will create the Boot Images to be loaded, via USB
using DFU utility. Device firmware upgrade (DFU) is intended to
download and upload firmware to/from devices connected over USB. In
this boot mode, the boot loader (FSBL) and the PMU firmware which are
loaded by bootROM are copied to Zynq UltraScale+ on-chip memory (OCM)
from the host machine USB port using DFU Utility. The size of OCM (256
KB) limits the size of boot image downloaded by bootROM in USB boot
mode. Considering this, and subject to size requirement being met,
only FSBL and PMU firmware are stitched into the first boot.bin, which
is copied to OCM. The remaining boot partitions will be stitched in
another boot image and copied to DDR to be loaded by the FSBL which is
already loaded and running at this stage. Follow these steps to create
boot images for this boot mode.</p>
<ol>
<li><p>In the Vitis IDE, select <strong>Xilinx → Create Boot Image</strong>.</p></li>
<li><p>Select <code class="docutils literal notranslate"><span class="pre">fsbl_usb_boot.elf</span></code> and
<code class="docutils literal notranslate"><span class="pre">pmufw.elf</span></code> partitions and set them as shown in the following
figure.</p>
<p><img alt="ZynqMPSoC-EDT\docs\./media/image77.png" src="ZynqMPSoC-EDT\docs\./media/image77.png" /></p>
</li>
<li><p>Ensure that PMU partition is set to be loaded by bootROM.</p></li>
<li><p>Click <strong>Create Image</strong> to generate BOOT.bin.</p></li>
</ol>
<div class="section" id="modifying-petalinux-u-boot">
<h4>Modifying PetaLinux U-Boot<a class="headerlink" href="#modifying-petalinux-u-boot" title="Permalink to this headline">¶</a></h4>
<p>Modify PetaLinux U-Boot so that it can load the image.ub image. The
device tree needs to be modified to set USB in the Peripheral mode.
The default PetaLinux configuration is set for the USB in host mode.
Follow these steps to modify <code class="docutils literal notranslate"><span class="pre">system-user.dtsi</span></code> in the PetaLinux project</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;PetaLinux-project&gt;/project-spec/meta-user/recipes-bsp/device-tree/</span> <span class="pre">files/system-user.dtsi</span></code>.</p>
<ol>
<li><p>Add the following to system-user.dtsi, so that it looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">include</span><span class="o">/</span> <span class="s2">&quot;system-conf.dtsi&quot;</span>
<span class="o">/</span> <span class="p">{</span>
<span class="n">gpio</span><span class="o">-</span><span class="n">keys</span> <span class="p">{</span> <span class="n">sw19</span> <span class="p">{</span>
<span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;disabled&quot;</span><span class="p">;</span>
<span class="p">};</span>
<span class="p">};</span>
<span class="p">};</span>
<span class="o">&amp;</span><span class="n">uart1</span>
<span class="p">{</span>
<span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;disabled&quot;</span><span class="p">;</span>
<span class="p">};</span>
<span class="o">&amp;</span><span class="n">dwc3_0</span> <span class="p">{</span>
<span class="n">dr_mode</span> <span class="o">=</span> <span class="s2">&quot;peripheral&quot;</span><span class="p">;</span> <span class="n">maximum</span><span class="o">-</span><span class="n">speed</span> <span class="o">=</span> <span class="s2">&quot;super-speed&quot;</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The modified system-user.dtsi file can be found in <code class="docutils literal notranslate"><span class="pre">&lt;Design</span> <span class="pre">Files&gt;/usb_boot</span></code> released with the tutorial.</p>
</li>
<li><p>Build PetaLinux with the following changes.</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">petalinux-build</span></code></p>
</li>
</ol>
<p>The following steps describe how to create a <code class="docutils literal notranslate"><span class="pre">usb_boot.bin</span></code> comprising rest of the partitions.</p>
<blockquote>
<div><p><strong><em>Note</em>:</strong> Copy the newly generated U-Boot to <code class="docutils literal notranslate"><span class="pre">C:\edt\usb_boot\</span></code>. The <code class="docutils literal notranslate"><span class="pre">u-boot.elf</span></code> is also available in <a class="reference external" href="2-getting-started.md#design-files-for-this-tutorial">Design Files for This Tutorial</a>.</p>
</div></blockquote>
<ol>
<li><p>In the Vitis IDE, select <strong>Xilinx → Create Boot Image</strong>.</p></li>
<li><p>Select <strong>FSBL</strong> and rest of the partitions and set them as shown in
the following figure. You can also choose to import the BIF file
from the SD boot sequence.</p>
<p><img alt="ZynqMPSoC-EDT\docs\./media/image78.png" src="ZynqMPSoC-EDT\docs\./media/image78.png" /></p>
<blockquote>
<div><p><strong><em>Note</em>:</strong> Ensure that you have set the correct exception levels for
ATF (EL-3, TrustZone) and U-Boot (EL-2) partitions. These settings can
be ignored for other partitions.</p>
</div></blockquote>
<p>The PMU firmware partition is not required in this image, as
it will be loaded by the bootROM before this image (<code class="docutils literal notranslate"><span class="pre">usb_boot.bin</span></code>)
is loaded.</p>
</li>
<li><p>Click on <strong>Create Image</strong> to generate <code class="docutils literal notranslate"><span class="pre">usb_boot.bin</span></code>.</p>
<blockquote>
<div><p><strong><em>Note</em>:</strong> In addition to <code class="docutils literal notranslate"><span class="pre">BOOT.bin</span></code> and <code class="docutils literal notranslate"><span class="pre">usb_boot.bin</span></code>, the Linux image
like image.ub is required to boot till Linux. This <code class="docutils literal notranslate"><span class="pre">image.ub</span></code> is loaded by the DFU utility separately.</p>
</div></blockquote>
</li>
</ol>
</div>
</div>
<div class="section" id="boot-using-usb-boot">
<h3>Boot using USB Boot<a class="headerlink" href="#boot-using-usb-boot" title="Permalink to this headline">¶</a></h3>
<p>In this section you will load the boot images on ZCU102 target using
DFU utility. Before you start, set the board connections as shown
below:</p>
<ol>
<li><p>Set ZCU102 for USB Boot mode by
setting SW6 (1-OFF, 2-OFF, 3-OFF, and 4-ON), as shown below:</p>
<p><img alt="ZynqMPSoC-EDT\docs\./media/image79.jpeg" src="ZynqMPSoC-EDT\docs\./media/image79.jpeg" /></p>
</li>
<li><p>Connect a USB 3.0 Cable to J96 USB 3 ULPI Connector, and the other
end of the Cable to USB port on the host machine.</p></li>
<li><p>Connect a USB Micro cable between USB-UART port on Board (J83) and
the host machine.</p></li>
<li><p>Start a terminal session, using Tera Term or Minicom depending on
the host machine being used, as well as the COM port and baud rate
for your system.</p></li>
<li><p>Power ON the board.</p></li>
</ol>
<p>The following steps will load the boot images via USB using DFU
utility, which can be found in <code class="docutils literal notranslate"><span class="pre">VITIS\2019.1\tps\lnx64\dfu-util-0.9</span></code>.</p>
<p>Alternatively you can also install DFU utility on the Linux using
Package Manager supported by Linux Distribution.</p>
<div class="section" id="boot-commands-for-linux-host-machine">
<h4>Boot Commands for Linux Host Machine<a class="headerlink" href="#boot-commands-for-linux-host-machine" title="Permalink to this headline">¶</a></h4>
<ol>
<li><p>Check if the DFU can detect the USB target.</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">sudo</span> <span class="pre">dfu-util</span> <span class="pre">-l</span></code></p>
<p>The USB device should be enumerated with VendorId: ProductId which is
<code class="docutils literal notranslate"><span class="pre">03fd:0050</span></code>. You should see something like the following message:</p>
<div class="highlight-Found DFU: [03fd:0050] ver=0100, devnum=30, cfg=1, intf=0, alt=0, notranslate"><div class="highlight"><pre><span></span>name=&quot;Xilinx DFU Downloader&quot;, serial=&quot;2A49876D9CC1AA4&quot;
</pre></div>
</div>
<blockquote>
<div><p><strong><em>Note</em>:</strong> If you do not see the ‘Found DFU’ message, verify the
connection and retry.</p>
</div></blockquote>
</li>
<li><p>Now download the BOOT.bin that was created in <a class="reference external" href="#creating-boot-images-for-usb-boot">Creating Boot Images
for USB Boot</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">sudo</span> <span class="pre">dfu-util</span> <span class="pre">-d</span> <span class="pre">03fd:0050</span> <span class="pre">-D</span> <span class="pre">&lt;USB_Boot_Image_Path&gt;/Boot.bin</span></code></p>
<p>Verify from Serial Terminal if the FSBL is loaded successfully.</p>
</li>
<li><p>Now download the usb_boot.bin. Before this, start another terminal
session for UART-1 serial console.</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">sudo</span> <span class="pre">dfu-util</span> <span class="pre">-d</span> <span class="pre">03fd:0050</span> <span class="pre">-D</span> <span class="pre">&lt;USB_Boot_Image_Path&gt;/usb_boot.bin</span></code></p>
<p>Check UART 0 terminal and wait until U-Boot loads.</p>
</li>
<li><p>On U-Boot prompt, type <strong>Enter</strong> to terminate autoboot. Verify from
the UART1 console that the R5 application is also loaded
successfully.</p></li>
<li><p>Run the following commands to setup the dfu environment in the
U-Boot command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ setenv loadaddr 0x10000000
$ setenv kernel_addr 0x10000000
$ setenv kernel_size 0x1e00000
$ setenv dfu_ram_info &quot;setenv dfu_alt_info image.ub ram $kernel_addr
$kernel_size&quot;
</pre></div>
</div>
</li>
<li><p>In U-Boot console start DFU_RAM to enable downloading Linux Images</p>
<p><code class="docutils literal notranslate"><span class="pre">U-boot\</span> <span class="pre">run</span> <span class="pre">dfu_ram</span></code></p>
</li>
<li><p>Download the Linux image Image.ub using the following command from
the host machine terminal:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">sudo</span> <span class="pre">dfu-util</span> <span class="pre">-d</span> <span class="pre">03fd:0300</span> <span class="pre">-D</span> <span class="pre">&lt;PetaLinux_project&gt;/images/linux/image.ub</span> <span class="pre">-a</span> <span class="pre">0</span></code></p>
</li>
<li><p>Now execute <strong>CTRL+C</strong> on U-Boot console to stop dfu_ram.</p></li>
<li><p>Run bootm command from the U-Boot console.</p>
<p><code class="docutils literal notranslate"><span class="pre">U-boot\</span> <span class="pre">bootm</span></code></p>
</li>
<li><p>Verify that Linux loads successfully on the target.</p></li>
</ol>
<blockquote>
<div><p><strong><em>Note</em>:</strong> In this example, image.ub is copied to DDR location based
on #define DFU_ALT_INFO_RAM settings in U-Boot configuration. The
same can be modified to copy other image files to DDR location. Then,
if required, these images can be copied to QSPI using U-Boot commands
listed in <a class="reference external" href="#boot-sequence-for-qspi-boot-mode-using-jtag">Boot Sequence for QSPI-Boot Mode Using JTAG</a>.</p>
</div></blockquote>
</div>
<div class="section" id="boot-commands-for-windows-host-machine">
<h4>Boot Commands for Windows Host Machine<a class="headerlink" href="#boot-commands-for-windows-host-machine" title="Permalink to this headline">¶</a></h4>
<ol>
<li><p>In the Vitis IDE, Select <strong>Xilinx → Launch Shell</strong>.</p></li>
<li><p>In shell, check if the DFU can detect the USB target:</p>
<p><code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">dfu-util.exe</span> <span class="pre">-l</span></code></p>
<blockquote>
<div><p><strong><em>Note</em>:</strong> <code class="docutils literal notranslate"><span class="pre">dfu-util.exe</span></code> can be found in <code class="docutils literal notranslate"><span class="pre">&lt;VITIS_Installation_path&gt;\VITIS\2020.1\tps\Win64\dfu-util-0.9\dfu-util.exe</span></code></p>
</div></blockquote>
</li>
<li><p>The USB device should be enumerated with VendorId: ProductId which
is <code class="docutils literal notranslate"><span class="pre">03fd:0050</span></code>.</p>
<blockquote>
<div><p><strong><em>Note</em>:</strong> If you do not see the message starting with “Found DFU”,
download and install “zadig” software. Open the software and click
<strong>Options</strong> and select <strong>List all devices</strong>. Select device <strong>Xilinx
Dfu Downloader</strong> and click <strong>Install driver</strong>.</p>
</div></blockquote>
</li>
<li><p>Now download the Boot.bin that was created in <a class="reference external" href="#creating-boot-images-for-usb-boot">Creating Boot Images for USB Boot</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">dfu-util.exe</span> <span class="pre">-d</span> <span class="pre">03fd:0050</span> <span class="pre">-D</span> <span class="pre">BOOT.bin</span></code></p>
</li>
<li><p>Verify from Serial Terminal (UART 0) that FSBL is loaded
successfully.</p></li>
<li><p>Now download the usb_boot.bin. Before this start another terminal
session for UART-1 serial console.</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">dfu-util.exe</span> <span class="pre">-d</span> <span class="pre">03fd:0050</span> <span class="pre">-D</span> <span class="pre">usb_boot.bin</span></code></p>
</li>
<li><p>On U-Boot prompt type Enter to terminate auto-boot. Verify from
UART1 console that the R5 application is also loaded successfully.</p>
<blockquote>
<div><p><strong><em>Note</em>:</strong> At this point, use Zadig utility to install drivers for
“USB download gadget” with device ID 03fd:0300. Without this, zadig
software does not show “Xilinx DFU Downloader” after booting U-Boot
on target.</p>
</div></blockquote>
</li>
<li><p>Run the following commands to setup the dfu environment in U-Boot
command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ setenv loadaddr 0x10000000
$ setenv kernel_addr 0x10000000
$ setenv kernel_size 0x1e00000
$ setenv dfu_ram_info &quot;setenv dfu_alt_info image.ub ram $kernel_addr $kernel_size&quot;
</pre></div>
</div>
</li>
<li><p>In U-Boot console, start DFU_RAM to enable downloading Linux Images:</p>
<p><code class="docutils literal notranslate"><span class="pre">U-boot\</span> <span class="pre">run</span> <span class="pre">dfu_ram</span></code></p>
</li>
<li><p>Download Linux image image.ub using the following command from the
host machine terminal:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">dfu-util.exe</span> <span class="pre">-d</span> <span class="pre">03fd:0300</span> <span class="pre">-D</span> <span class="pre">image.ub</span> <span class="pre">-a</span> <span class="pre">0</span></code></p>
</li>
<li><p>Run bootm command from the U-Boot console.</p>
<p><code class="docutils literal notranslate"><span class="pre">U-boot\</span> <span class="pre">bootm</span></code></p>
</li>
<li><p>Verify that Linux loads successfully on the target.</p></li>
</ol>
<p>© Copyright 2017-2020 Xilinx, Inc.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on January 19, 2021.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2020, Xilinx
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>