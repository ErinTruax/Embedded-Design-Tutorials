


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../../../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="../../../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../../../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../../../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/header-footer.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../../../_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all/resources/imgs/header/xilinx-header-logo.svg" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search"
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a>
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="../../../_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search"
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Embedded Design Tutorials
          

          
          </a>

          
            
            
              <div class="version">
                2020.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/Embedded-Design-Tutorials/tree/master">Master</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../../../_sources/ZynqMPSoC-EDT/docs/featured-tutorials/2-secure-boot.md.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Embedded Design Tutorials</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Secure Boot Sequence</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/ZynqMPSoC-EDT/docs/featured-tutorials/2-secure-boot.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="secure-boot-sequence">
<h1>Secure Boot Sequence<a class="headerlink" href="#secure-boot-sequence" title="Permalink to this headline">¶</a></h1>
<p>The secure boot functionality in Zynq UltraScale+ MPSoC allows you to
support confidentiality, integrity, and authentication of partitions.
Secure boot is accomplished by combining the Hardware Root of Trust
(HROT) capabilities of the Zynq UltraScale+ device with the option of
encrypting all boot partitions. The HROT is based on the RSA-4096
asymmetric algorithm with SHA-3/384, which is hardware accelerated.
Confidentiality is provided using 256-bit Advanced Encryption Standard Galois Counter Mode (AES-GCM). This section focuses on how to use
and implement the following:</p>
<ul class="simple">
<li><p>Hardware Root of Trust with Key Revocation</p></li>
<li><p>Partition Encryption with Differential Power Analysis (DPA)
Countermeasures</p></li>
<li><p>Black Key Storage using the Physically Unclonable Function (PUF)</p></li>
</ul>
<p>The section <a class="reference external" href="#secure-boot-system-design-decisions">Secure Boot System Design
Decisions</a> outlines high level
secure boot decisions which should be made early in design
development. The <a class="reference external" href="#hardware-root-of-trust">Hardware Root of Trust</a>
section discusses the use of a Root of Trust (RoT) in boot. The <a class="reference external" href="#boot-image-confidentiality-and-dpa">Boot Image Confidentiality and DPA</a>
section discusses methods to use AES encryption.</p>
<p>The <a class="reference external" href="#boot-image-confidentiality-and-dpa">Boot Image Confidentiality and DPA</a> section discusses the use of
the operational key and key rolling techniques as countermeasures to a
DPA attack. Changing the AES key reduces the exposure of both the key
and the data protected by the key.</p>
<p>A red key is a key in unencrypted format. The <a class="reference external" href="#black-key-storage">Black Key Storage</a> section provides a method for storing the AES key in encrypted, or black format. Black key store uses the physically unclonable function (PUF) as a Key Encryption Key (KEK).</p>
<p>The <a class="reference external" href="#practical-methods-in-secure-boot">Practical Methods in Secure Boot</a> section provides steps to
develop and test systems that use AES encryption and RSA
authentication.</p>
<div class="section" id="secure-boot-system-design-decisions">
<h2>Secure Boot System Design Decisions<a class="headerlink" href="#secure-boot-system-design-decisions" title="Permalink to this headline">¶</a></h2>
<p>The following are device level decisions affecting secure boot:</p>
<ul class="simple">
<li><p>Boot mode</p></li>
<li><p>AES key storage location</p></li>
<li><p>AES storage state (encrypted or unencrypted)</p></li>
<li><p>Encryption and authentication requirements</p></li>
<li><p>Key provisioning</p></li>
</ul>
<p>The boot modes which support secure boot are Quad Serial Peripheral
Interface (QSPI), SD, eMMC, USB Boot, and NAND. The AES key is stored
in either eFUSEs (encrypted or unencrypted), Battery Backed Random
Access Memory (BBRAM) (unencrypted only), or in external NVM
(encrypted only).</p>
<p>In Zynq UltraScale+ MPSoC, partitions can be encrypted and/or
authenticated on a partition basis. Xilinx generally recommends that
all partitions be RSA authenticated. Partitions that are open source
(U-Boot, Linux), or do not contain any proprietary or confidential
information, typically do not need to be encrypted. In systems in
which there are multiple sources/suppliers of sensitive data and/or
proprietary IP, encrypting the partitions using unique keys may be
important.</p>
<p>DPA resistance requirements are dictated by whether the adversary has
physical access to the device.</p>
<p>The following table can be a good reference while deciding on features
required to meet a specific secure system requirement. Next sections
will discuss the features in more detail.</p>
<p><em>Table 10:</em> <strong>System Level Security Requirements</strong></p>
<table border="1" class="docutils">
<thead>
<tr>
<th>System Consideration/</th>
<th>Zynq UltraScale+ Feature</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ensure that only the users software and hardware runs on the device</td>
<td>HWROT</td>
</tr>
<tr>
<td>Guarantee that the users software and hardware are not modified</td>
<td>HWROT</td>
</tr>
<tr>
<td>Ensure that an adversary cannot clone or reverse engineer software/hardware</td>
<td>Boot Image Confidentiality</td>
</tr>
<tr>
<td>Protect sensitive data and proprietary Intellectual Property (IP)</td>
<td>Boot Image Confidentiality</td>
</tr>
<tr>
<td>Ensure that Private Key (AES key) is protected against side channel attacks</td>
<td>DPA Protections</td>
</tr>
<tr>
<td>Private/Secret keys (AES key) is stored encrypted at rest</td>
<td>Black Key Storage</td>
</tr>
</tbody>
</table><div class="section" id="hardware-root-of-trust">
<h3>Hardware Root of Trust<a class="headerlink" href="#hardware-root-of-trust" title="Permalink to this headline">¶</a></h3>
<p>Root of trusts are security primitives for storage (RTS), integrity
(RTI), verification (RTV), measurement (RTM), and reporting (RTR). RoT
consists of hardware, firmware, and software. The HROT has advantages
over software RoTs because the HROT is immutable, has a smaller attack
surface, and the behavior is more reliable.</p>
<p>The HROT is based on the CSU, eFUSEs, BBRAM, and isolation elements.
The HROT is responsible for validating that the operating environment
and configuration have not been modified. The RoT acts as an anchor
for boot, so an adversary can not insert malicious code before
detection mechanisms start.</p>
<p>Firmware and software run on the HROT during boot. Zynq UltraScale+
provides immutable bootROM code, a first stage boot loader, device
drivers, and the XILSKEY and XILSECURE libraries which run on the
HROT. These provide a well-tested, proven in use API so that
developers do not create security components from scratch with limited
testing.</p>
<div class="section" id="data-integrity">
<h4>Data Integrity<a class="headerlink" href="#data-integrity" title="Permalink to this headline">¶</a></h4>
<p>Data integrity is the absence of corruption of hardware, firmware and
software. Data integrity functions verify that an adversary has not
tampered with the configuration and operating environment.</p>
<p>Zynq UltraScale+ verifies the integrity of partition(s) using both
symmetric key (AES-GCM) and asymmetric key (RSA) authentication. RSA
uses a private/public key pair. The fielded embedded system only has
the public key. Theft of the public key is of limited value since it
is not possible, with current technology, to derive the private key
from the public key.</p>
<p>Encrypted partitions are also authenticated using the Galois Counter
Mode (GCM) mode of AES. In the secure boot flow, partitions are first
authenticated and then decrypted if necessary.</p>
</div>
<div class="section" id="authentication">
<h4>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h4>
<p>The following figure shows RSA signing and verification of partitions.
From a secure facility, the Bootgen tool signs partitions, using the
private key. In the device, the ROM verifies the FSBL and either the
FSBL or U-Boot verifies the subsequent partitions, using the public
key.</p>
<p>Primary and secondary private/public key pairs are used. The function
of the primary private/ public key pair is to authenticate the
secondary private/public key pair. The function of the secondary key
is to sign/verify partitions.</p>
<p><img alt="ZynqMPSoC-EDT\docs\featured-tutorials\./media/zynqus-rsa-auth.png" src="ZynqMPSoC-EDT\docs\featured-tutorials\./media/zynqus-rsa-auth.png" /></p>
<p>To sign a partition, Bootgen first calculates the SHA3 of the
partition data. The 384-bit hash is then RSA signed using the private
key. The resulting RSA signature is placed in the authentication
certificate. In the image, each signed partition has partition data
followed by an authentication certificate which includes the RSA
signature.</p>
<p>Verification of the FSBL is handled by the CSU ROM code. To verify the
subsequent partitions, the FSBL or U-Boot uses the XILSECURE library.</p>
<p>There is a debug mode for authentication called bootheader
authentication. In this mode of authentication, the CSU ROM code does
not check the primary public key digests, the session key ID or the
key revocation bits stored in the device eFUSEs. Therefore, this mode
is not secure. However, it is useful for testing and debugging as it
does not require programming of eFUSEs.</p>
<p>This tutorial uses this mode. However, fielded systems should not use
boot header authentication. The example BIF file for a fully secured
system is included at the end of this section.</p>
</div>
</div>
<div class="section" id="boot-image-confidentiality-and-dpa">
<h3>Boot Image Confidentiality and DPA<a class="headerlink" href="#boot-image-confidentiality-and-dpa" title="Permalink to this headline">¶</a></h3>
<p>AES is used to ensure confidentiality of sensitive data and IP. Zynq
UltraScale+ uses AES Galois Counter Mode (GCM). Zynq UltraScale+ uses
a 256 AES bit key. The principle AES enhancements provided by Zynq
UltraScale+ are increased resistance to Differential Power Analysis
(DPA) attacks and the availability of AES encryption/decryption post
boot.</p>
<p>Bootgen and FSBL software support AES encryption. Private keys are
used in AES encryption, and AES encryption is done by Bootgen using
the key files. The key files can be generated by Bootgen or OpenSSL.
The use of the operational key limits the exposure of the device key.
The use of the operational key in key rolling is discussed in the next
section. To maintain Boot image confidentiality, Encrypted Boot images
can be created using Bootgen. Software examples to program keys to
BBRAM and eFUSE are also available in the Vitis IDE. One such example
is discussed in <a class="reference external" href="#practical-methods-in-secure-boot">Practical Methods in Secure Boot</a>.</p>
</div>
<div class="section" id="dpa-protections">
<h3>DPA Protections<a class="headerlink" href="#dpa-protections" title="Permalink to this headline">¶</a></h3>
<p>Key rolling is used for DPA resistance. Key rolling and black key
store can be used in the same design. In key rolling, software and
bitstream is broken up into multiple data blocks, each encrypted with
a unique AES key. The initial key is stored in BBRAM or eFUSE NVM.
Keys for successive data blocks are encrypted in the previous data
block. After the initial key, the key update register is used as the
key source.</p>
<p>A 96-bit initialization vector is included in the NKY key file. The IV
uses 96 bits to initialize AES counters. When key rolling is used, a
128-bit IV is provided in the bootheader. The 32 least significant
bits define the block size of data to decrypt using the current key.
The block sizes following the initial block defined in the IV are
defined as attributes in the Bootgen Image Format (BIF) file.</p>
<p>An efficient method of key rolling uses the operational key. With the
operational key, Bootgen creates an encrypted secure header with the
user specified operational key and the first block IV. The AES key in
eFUSE or BBRAM is used only to decrypt the 384-bit secure header with
the 256-bit operational key. This limits the exposure of the device
key to DPA attacks.</p>
</div>
<div class="section" id="black-key-storage">
<h3>Black Key Storage<a class="headerlink" href="#black-key-storage" title="Permalink to this headline">¶</a></h3>
<p>The PUF enables storing the AES key in encrypted (black) format. The
black key can be stored either in eFUSEs or in the bootheader. When
needed for decryption, the encrypted key in eFUSEs or the bootheader
is decrypted using the PUF generated key encrypting key (KEK).</p>
<p>There are two steps in using the PUF for black key storage. In the
first, PUF registration software is used to generate PUF helper data
and the PUF KEK. The PUF registration data allows the PUF to
re-generate the identical key each time the PUF generates the KEK. For
more details on the use of PUF registration software, see <a class="reference external" href="#puf-registration-in-bootheader-mode">PUF Registration in Bootheader Mode</a>. For more information on
PUF Registration - eFUSE mode, see <em>Programming BBRAM and eFUSEs</em>
(<a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/ndoc?t=application_notes%3Bd%3Dxapp1319-zynq-usp-prog-nvm.pdf">XAPP1319</a>).</p>
<p>The helper data and encrypted user key must both be stored in eFUSEs
if the PUF eFUSE mode is used, and in the bootheader if the PUF
Bootheader mode is used. The procedure for the PUF bootheader mode is
discussed in <a class="reference external" href="#using-puf-in-bootheader-mode">Using PUF in Bootheader Mode</a>. For the procedure to use PUF in
eFUSE mode, see <em>Programming BBRAM and eFUSEs</em>
(<a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/ndoc?t=application_notes%3Bd%3Dxapp1319-zynq-usp-prog-nvm.pdf">XAPP1319</a>).</p>
<p>This tutorial uses PUF bootheader mode as it does not require
programming of eFUSEs, and is therefore useful for test and debug.
However, the most common mode is PUF eFUSE mode, as the PUB Bootheader
mode requires a unique run of bootgen for each and every device. The
example BIF file for a fully secured system is included at the end of
the <a class="reference external" href="#secure-boot-sequence">Secure Boot Sequence</a> section demonstrates
the PUF eFUSE mode.</p>
</div>
</div>
<div class="section" id="practical-methods-in-secure-boot">
<h2>Practical Methods in Secure Boot<a class="headerlink" href="#practical-methods-in-secure-boot" title="Permalink to this headline">¶</a></h2>
<p>This section outlines the steps to develop secure boot in a Zynq
UltraScale+ system. Producing a secure embedded system is a two-step
process. In the first phase, the cryptographic keys are generated and
programmed into NVM. In the second phase, the secure system is
developed and tested. Both steps use the Vitis IDE to create software
projects, generate the image, and program the image. For the second
phase, a test system can be as simple as fsbl.elf and hello.elf files.
In this section, you will use the same images used in <a class="reference external" href="#boot-sequence-for-sd-boot">Boot Sequence for SD-Boot</a>, but this time the images
will be assembled together, and have the secure attributes enabled as
part of the secure boot sequence.</p>
<p>This section starts by showing how to generate AES and RSA keys.
Following key generation, systems using the advanced AES and RSA
methods are developed and tested. Keys generated in this section are
also included in the <a class="reference external" href="2-getting-started.md#design-files-for-this-tutorial">Design Files for This Tutorial</a>, released with this
tutorial.</p>
<p>The methods used to develop AES functionality are provided in the
following sections:</p>
<ul class="simple">
<li><p><a class="reference external" href="#generating-keys-for-authentication">Generating Keys for Authentication</a></p></li>
<li><p><a class="reference external" href="#enabling-encryption-using-key-rolling">Enabling Encryption Using Key Rolling</a></p></li>
<li><p><a class="reference external" href="#enable-use-of-an-operational-key">Enable Use of an Operational Key</a></p></li>
<li><p>AES key in eFUSE</p></li>
<li><p><a class="reference external" href="#using-the-puf">Using the PUF</a></p></li>
</ul>
<p><a class="reference external" href="#creating-rsa-privatepublic-key-pairs">Creating RSA Private/Public Key Pairs</a> provides the steps to
authenticate all partitions loaded at boot. This section also shows
how to revoke keys.</p>
<p>A requirement in the development of a secure system is to add security
attributes which are used in image generation. Bootgen generates a
Boot Image Format (BIF) file. The BIF file is a text file. In its
simplest form, the BIF is a list of partitions to be loaded at boot.
Security attributes are added to the BIF to specify cryptographic
functionality. In most cases, the Bootgen GUI (Create Boot Image
wizard) is used to generate the BIF file. In some cases, adding
security attributes requires editing the Bootgen generated BIF file.
In Create Boot Image Wizard in the Vitis IDE, after the Security tab
is selected, the Authentication and Encryption tabs are used to
specify security attributes.</p>
<p>After implementing AES and RSA cryptography in secure boot, a boot
test is done. The system loads successfully and displays the FSBL
messages on the terminal. These messages indicate the cryptographic
operations performed on each partition. <a class="reference external" href="8-debugging-problems-with-secure-boot">Debugging Problems with Secure Boot</a> provides steps
that are required to use, if the secure boot test fails.</p>
<div class="section" id="sample-design-overview">
<h3>Sample Design Overview<a class="headerlink" href="#sample-design-overview" title="Permalink to this headline">¶</a></h3>
<p>The sample design demonstrates loading various types of images into
the device. It includes loading a FSBL, PMU Firmware, U-Boot, Linux,
RPU software and a PL configuration image. In this sample, all of
these images are loaded by the FSBL which performs all authentication
and decryption. This is not the only means of booting a system.
However, it is the simple and secure method, as of 2019.1.</p>
<p>(./media/sample-design.png)</p>
<p>Different sections within the boot image have different levels of
security and are loaded into different locations. The following table
explains the contents of the final boot image.</p>
<p><strong>Final Boot Image with Secure Attributes</strong></p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Binary</th>
<th>RSA Authenticated</th>
<th>AES Encrypted</th>
<th>Exception Level</th>
<th>Loader</th>
</tr>
</thead>
<tbody>
<tr>
<td>FSBL</td>
<td>Yes</td>
<td>Yes</td>
<td>EL3</td>
<td>CSU ROM</td>
</tr>
<tr>
<td>PMU Firmware</td>
<td>Yes</td>
<td>Yes</td>
<td>NA</td>
<td>FSBL</td>
</tr>
<tr>
<td>PL Bitstream</td>
<td>Yes</td>
<td>Yes</td>
<td>NA</td>
<td>FSBL</td>
</tr>
<tr>
<td>Arm Trusted Firmware (ATF)</td>
<td>Yes</td>
<td>No</td>
<td>EL3</td>
<td>FSBL</td>
</tr>
<tr>
<td>R5 Software</td>
<td>Yes</td>
<td>Yes</td>
<td>NA</td>
<td>FSBL</td>
</tr>
<tr>
<td>U-Boot</td>
<td>Yes</td>
<td>No</td>
<td>EL2</td>
<td>FSBL</td>
</tr>
<tr>
<td>Linux</td>
<td>Yes</td>
<td>No</td>
<td>EL1</td>
<td>FSBL</td>
</tr>
</tbody>
</table><blockquote>
<div><p><strong><em>Notes</em>:</strong></p>
<ol class="simple">
<li><p>In a secure boot sequence, the PMU image is loaded by the FSBL. Using the bootROM/CSU to load the PMU firmware introduces a security weakness as the key/IV combination is used twice. First to decrypt the FSBL and then again to decrypt the PMU image. This is not allowed for the secure systems.</p></li>
<li><p>As of 2019.1, U-Boot does not perform a secure authenticated loading of Linux. So instead of U-Boot, FSBL loads the Linux images to memory address and then uses U-Boot to jump to that memory address.</p></li>
</ol>
</div></blockquote>
<p>This tutorial demonstrates assembling the binaries that are created
using <a class="reference external" href="7-system-design-examples">System Design Examples</a> in a boot image with all the security features
enabled. This section also shows how PL bitstream can be added as a
part of secure boot flow. Follow the information in this chapter until <a class="reference external" href="7-system-design-examples.md#modifying-the-build-settings">Modifying the
Build Settings</a> to create all the
necessary files and then switch back.</p>
<p>Enabling the security features in boot image is done in two different
methods. During the first method, the BIF file is manually created
using a text editor and then using that BIF file to have Bootgen
create keys. This enables you to identify the sections of the BIF file
that are enabled which security features. The second method uses the
Create Boot Image wizard in the Vitis IDE. It demonstrates the same
set of security features and reuses the keys from the first method for
convenience.</p>
</div>
<div class="section" id="generating-keys-for-authentication">
<h3>Generating Keys for Authentication<a class="headerlink" href="#generating-keys-for-authentication" title="Permalink to this headline">¶</a></h3>
<p>There are multiple methods of generating keys. These include, but are
not limited to, using bootgen, customized key files, OpenSSL and
Hardware Security Modules (HSMs). This tutorial covers methods using
bootgen. The bootgen created files can be used as templates for
creating files containing user-specified keys from the other key
sources.</p>
<p>The creation of keys using bootgen commands requires the generation
and modification of the BIF files. The key generation section of this
tutorial creates these bif files “by hand” using a text editor. The
next section, building your boot image demonstrates how to create
these BIF files using the Bootgen GUI (create Boot Image Wizard).</p>
</div>
<div class="section" id="creating-rsa-private-public-key-pairs">
<h3>Creating RSA Private/Public Key Pairs<a class="headerlink" href="#creating-rsa-private-public-key-pairs" title="Permalink to this headline">¶</a></h3>
<p>For this example, you will create the primary and secondary keys in
the PEM format. The keys are generated using Bootgen command-line
options. Alternately, you can create the keys using external tools
like OpenSSL.</p>
<p>The following steps describe the process of creating the RSA
private/public key pairs:</p>
<ol>
<li><p>Launch the shell from the Vitis IDE.</p></li>
<li><p>Select <strong>Xilinx → Vitis Shell</strong>.</p></li>
<li><p>Create a file named <code class="docutils literal notranslate"><span class="pre">key_generation.bif</span></code>.</p>
<blockquote>
<div><p><strong><em>Note</em>:</strong> The <code class="docutils literal notranslate"><span class="pre">key_generation.bif</span></code> file will be used to create both
the asymmetric keys in these steps and the symmetric keys in later
steps.</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">the_ROM_image</span><span class="p">:</span>
<span class="p">{</span>
<span class="p">[</span><span class="n">pskfile</span><span class="p">]</span><span class="n">psk0</span><span class="o">.</span><span class="n">pem</span> <span class="p">[</span><span class="n">sskfile</span><span class="p">]</span><span class="n">ssk0</span><span class="o">.</span><span class="n">pem</span>
<span class="p">[</span><span class="n">auth_params</span><span class="p">]</span><span class="n">spk_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ppk_select</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">[</span><span class="n">fsbl_config</span><span class="p">]</span><span class="n">a53_x64</span>
<span class="p">[</span><span class="n">bootloader</span><span class="p">]</span><span class="n">fsbl_a53</span><span class="o">.</span><span class="n">elf</span> <span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">pmu</span><span class="p">]</span><span class="n">pmufw</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_device</span> <span class="o">=</span> <span class="n">pl</span><span class="p">]</span><span class="n">edt_zcu102_wrapper</span><span class="o">.</span><span class="n">bit</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">trustzone</span><span class="p">]</span> <span class="n">bl31</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">r5</span><span class="o">-</span><span class="mi">0</span><span class="p">]</span><span class="n">tmr_psled_r5</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="n">u</span><span class="o">-</span><span class="n">boot</span><span class="o">.</span><span class="n">elf</span> <span class="p">[</span><span class="n">load</span> <span class="o">=</span>
<span class="mh">0x1000000</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">]</span><span class="n">image</span><span class="o">.</span><span class="n">ub</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Save the <code class="docutils literal notranslate"><span class="pre">key_generation.bif</span></code> file in the C:\edt\secure_boot_sd\keys directory.</p></li>
<li><p>Copy all of the ELF, BIF and UB files built in <a class="reference external" href="7-system-design-examples">System Design Examples</a> to <code class="docutils literal notranslate"><span class="pre">C:\edt\secure_boot_sd\keys</span> <span class="pre">directory</span></code>.</p></li>
<li><p>Navigate to the folder containing the BIF file.</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">C:\edt\secure_boot_sd\keys</span></code></p>
</li>
<li><p>Run the following command to generate the keys:</p>
<p><code class="docutils literal notranslate"><span class="pre">bootgen</span> <span class="pre">-p</span> <span class="pre">zu9eg</span> <span class="pre">-arch</span> <span class="pre">zynqmp</span> <span class="pre">-generate_keys</span> <span class="pre">auth</span> <span class="pre">pem</span> <span class="pre">-image</span> <span class="pre">key_generation.bif</span></code></p>
</li>
<li><p>Verify that the files <code class="docutils literal notranslate"><span class="pre">psk0.pem</span></code> and <code class="docutils literal notranslate"><span class="pre">ssk0.pem</span></code> are generated at the
location specified in the BIF file (<code class="docutils literal notranslate"><span class="pre">c:\edt\secure_boot_sd\keys</span></code>).</p></li>
</ol>
<div class="section" id="generate-sha3-of-public-key-in-rsa-private-public-key-pair">
<h4>Generate SHA3 of Public Key in RSA Private/Public Key Pair<a class="headerlink" href="#generate-sha3-of-public-key-in-rsa-private-public-key-pair" title="Permalink to this headline">¶</a></h4>
<p>The following steps are required only for RSA Authentication with
eFUSE mode, and can be skipped for RSA authentication with bootheader
mode. The 384 bits from sha3.txt can be programmed to eFUSE for RSA
Authentication with the eFUSE Mode. For more information, see
<em>Programming BBRAM and eFUSEs</em>
(<a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/ndoc?t=application_notes%3Bd%3Dxapp1319-zynq-usp-prog-nvm.pdf">XAPP1319</a>).</p>
<ol>
<li><p>Perform the steps from the prior section.</p></li>
<li><p>Now that the PEM files have been defined, add authentication = rsa
attributes as shown below to <code class="docutils literal notranslate"><span class="pre">key_generation.bif</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">the_ROM_image</span><span class="p">:</span>
<span class="p">{</span>
<span class="p">[</span><span class="n">pskfile</span><span class="p">]</span><span class="n">psk0</span><span class="o">.</span><span class="n">pem</span> <span class="p">[</span><span class="n">sskfile</span><span class="p">]</span><span class="n">ssk0</span><span class="o">.</span><span class="n">pem</span>
<span class="p">[</span><span class="n">auth_params</span><span class="p">]</span><span class="n">spk_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ppk_select</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">[</span><span class="n">fsbl_config</span><span class="p">]</span><span class="n">a53_x64</span>
<span class="p">[</span><span class="n">bootloader</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">fsbl_a53</span><span class="o">.</span><span class="n">elf</span> <span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">pmu</span><span class="p">,</span>
<span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">pmufw</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_device</span> <span class="o">=</span> <span class="n">pl</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">edt_zcu102_wrapper</span><span class="o">.</span><span class="n">bit</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">trustzone</span><span class="p">,</span>
<span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">bl31</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">r5</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">tmr_psled_r5</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">uboot</span><span class="o">.</span>
<span class="n">elf</span>
<span class="p">[</span><span class="n">load</span> <span class="o">=</span> <span class="mh">0x1000000</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">image</span><span class="o">.</span><span class="n">ub</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Use the bootgen command to calculate the hash of the PPK:</p>
<p><code class="docutils literal notranslate"><span class="pre">bootgen</span> <span class="pre">-p</span> <span class="pre">zcu9eg</span> <span class="pre">-arch</span> <span class="pre">zynqmp</span> <span class="pre">-efuseppkbits</span> <span class="pre">ppk0_digest.txt</span> <span class="pre">-image</span> <span class="pre">key_generation.bif</span></code></p>
</li>
<li><p>Verify that the file <code class="docutils literal notranslate"><span class="pre">ppk0_digest.txt</span></code> is generated at the location
specified (<code class="docutils literal notranslate"><span class="pre">c:\edt\secure_boot_sd\keys</span></code>).</p></li>
</ol>
</div>
<div class="section" id="additional-rsa-private-public-key-pairs">
<h4>Additional RSA Private/Public Key Pairs<a class="headerlink" href="#additional-rsa-private-public-key-pairs" title="Permalink to this headline">¶</a></h4>
<p>The steps in this section to generate Secondary RSA Private/Public key
pair required for key revocation, which requires programming of eFUSE.
For more information, see <em>Programming BBRAM and eFUSEs</em>
(<a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/ndoc?t=application_notes%3Bd%3Dxapp1319-zynq-usp-prog-nvm.pdf">XAPP1319</a>).
You can skip this section if you do not intend to use Key Revocation.</p>
<p>Repeat steps from <a class="reference external" href="#creating-rsa-privatepublic-key-pairs">Creating RSA Private/Public Key Pairs</a> and <a class="reference external" href="#generate-sha3-of-public-key-in-rsa-privatepublic-key-pair">Generate SHA3 of Public Key in RSA Private/Public Key Pair</a> to
generate the second RSA private/public key pair and generate the SHA3
of the second PPK.</p>
<ol>
<li><p>Perform the steps from the prior section but with replacing
<code class="docutils literal notranslate"><span class="pre">psk0.pem</span></code>, <code class="docutils literal notranslate"><span class="pre">ssk0.pem</span></code>, and <code class="docutils literal notranslate"><span class="pre">ppk0_digest.txt</span></code> with <code class="docutils literal notranslate"><span class="pre">psk1.pem</span></code>, <code class="docutils literal notranslate"><span class="pre">ssk1.pem</span></code>,
and <code class="docutils literal notranslate"><span class="pre">ppk1_digest.pem</span></code> respectively. Save this file as
<code class="docutils literal notranslate"><span class="pre">key_generation_1.bif</span></code>. That .bif file will look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">the_ROM_image</span><span class="p">:</span>
<span class="p">{</span>
<span class="p">[</span><span class="n">pskfile</span><span class="p">]</span><span class="n">psk1</span><span class="o">.</span><span class="n">pem</span> <span class="p">[</span><span class="n">sskfile</span><span class="p">]</span><span class="n">ssk1</span><span class="o">.</span><span class="n">pem</span>
<span class="p">[</span><span class="n">auth_params</span><span class="p">]</span><span class="n">spk_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">ppk_select</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">[</span><span class="n">fsbl_config</span><span class="p">]</span><span class="n">a53_x64</span>
<span class="p">[</span><span class="n">bootloader</span><span class="p">]</span><span class="n">fsbl_a53</span><span class="o">.</span><span class="n">elf</span> <span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">pmu</span><span class="p">]</span><span class="n">pmufw</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_device</span> <span class="o">=</span> <span class="n">pl</span><span class="p">]</span><span class="n">edt_zcu102_wrapper</span><span class="o">.</span><span class="n">bit</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">trustzone</span><span class="p">]</span><span class="n">bl31</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">r5</span><span class="o">-</span><span class="mi">0</span><span class="p">]</span><span class="n">tmr_psled_r5</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="n">u</span><span class="o">-</span><span class="n">boot</span><span class="o">.</span><span class="n">elf</span> <span class="p">[</span><span class="n">load</span> <span class="o">=</span>
<span class="mh">0x1000000</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">]</span><span class="n">image</span><span class="o">.</span><span class="n">ub</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Run the bootgen command to create the RSA private/public key pairs.</p>
<p><code class="docutils literal notranslate"><span class="pre">bootgen</span> <span class="pre">-p</span> <span class="pre">zu9eg</span> <span class="pre">-arch</span> <span class="pre">zynqmp</span> <span class="pre">-generate_keys</span> <span class="pre">auth</span> <span class="pre">pem</span> <span class="pre">-image</span> <span class="pre">key_generation_1.bif</span></code></p>
</li>
<li><p>Add authentication = rsa attributes to the <code class="docutils literal notranslate"><span class="pre">key_generation_1.bif</span></code> file. The .bif file will look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">the_ROM_image</span><span class="p">:</span>
<span class="p">{</span>
<span class="p">[</span><span class="n">pskfile</span><span class="p">]</span><span class="n">psk1</span><span class="o">.</span><span class="n">pem</span> <span class="p">[</span><span class="n">sskfile</span><span class="p">]</span><span class="n">ssk1</span><span class="o">.</span><span class="n">pem</span>
<span class="p">[</span><span class="n">auth_params</span><span class="p">]</span><span class="n">spk_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">ppk_select</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">[</span><span class="n">fsbl_config</span><span class="p">]</span><span class="n">a53_x64</span>
<span class="p">[</span><span class="n">bootloader</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">fsbl_a53</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">pmu</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">pmufw</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_device</span> <span class="o">=</span> <span class="n">pl</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">edt_zcu102_wrapper</span><span class="o">.</span><span class="n">bit</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">trustzone</span><span class="p">,</span>
<span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">bl31</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">r5</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">tmr_psled_r5</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">uboot</span><span class="o">.</span>
<span class="n">elf</span> <span class="p">[</span><span class="n">load</span> <span class="o">=</span> <span class="mh">0x1000000</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span>
<span class="n">rsa</span><span class="p">]</span><span class="n">image</span><span class="o">.</span><span class="n">ub</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Run the bootgen command to generate the hash of the primary RSA public key.</p>
<p><code class="docutils literal notranslate"><span class="pre">bootgen</span> <span class="pre">-p</span> <span class="pre">zcu9eg</span> <span class="pre">-arch</span> <span class="pre">zynqmp</span> <span class="pre">-efuseppkbits</span> <span class="pre">ppk1_digest.txt</span> <span class="pre">-image</span> <span class="pre">key_generation_1.bif</span></code></p>
</li>
<li><p>Verify that the files <code class="docutils literal notranslate"><span class="pre">ppk1.pem</span></code>, <code class="docutils literal notranslate"><span class="pre">spk1.pem</span></code>, and <code class="docutils literal notranslate"><span class="pre">ppk1_digest.txt</span></code> are
all generated at the location specified
(<code class="docutils literal notranslate"><span class="pre">c:\edt\secure_boot\keys</span></code>).</p></li>
</ol>
</div>
<div class="section" id="enabling-boot-header-authentication">
<h4>Enabling Boot Header Authentication<a class="headerlink" href="#enabling-boot-header-authentication" title="Permalink to this headline">¶</a></h4>
<p>Boot header authentication is a mode of authentication that instructs
the ROM to skip the checks of the eFUSE hashes for the PPKs, the
revocation status of the PPKs and the Session IDs for the secondary
keys. This mode is useful for testing and debugging as it does not
require programming of eFUSEs. This mode can be permanently disabled
for a device by programming the RSA_EN eFUSEs which forces RSA
Authentication with the eFUSE checks. Fielded systems should use the
RSA_EN eFUSE to force the eFUSE checks and disable Boot Header
Authentication.</p>
<p>Add the <code class="docutils literal notranslate"><span class="pre">bh_auth_enable</span></code> attribute to the [fsbl_config] line so that
the bif file appears as following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">the_ROM_image</span><span class="p">:</span>
<span class="p">{</span>
<span class="p">[</span><span class="n">pskfile</span><span class="p">]</span><span class="n">psk0</span><span class="o">.</span><span class="n">pem</span> <span class="p">[</span><span class="n">sskfile</span><span class="p">]</span><span class="n">ssk0</span><span class="o">.</span><span class="n">pem</span>
<span class="p">[</span><span class="n">auth_params</span><span class="p">]</span><span class="n">spk_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ppk_select</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">[</span><span class="n">fsbl_config</span><span class="p">]</span><span class="n">a53_x64</span><span class="p">,</span>
<span class="n">bh_auth_enable</span> <span class="p">[</span><span class="n">bootloader</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">fsbl_a53</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">pmu</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">pmufw</span><span class="o">.</span><span class="n">elf</span> <span class="p">[</span><span class="n">destination_device</span>
<span class="o">=</span> <span class="n">pl</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">edt_zcu102_wrapper</span><span class="o">.</span><span class="n">bit</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">trustzone</span><span class="p">,</span> <span class="n">authentication</span>
<span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">bl31</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">r5</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">tmr_psled_r5</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">uboot</span><span class="o">.</span>
<span class="n">elf</span> <span class="p">[</span><span class="n">load</span> <span class="o">=</span> <span class="mh">0x1000000</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span>
<span class="n">rsa</span><span class="p">]</span><span class="n">image</span><span class="o">.</span><span class="n">ub</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="generating-keys-for-confidentiality">
<h3>Generating Keys for Confidentiality<a class="headerlink" href="#generating-keys-for-confidentiality" title="Permalink to this headline">¶</a></h3>
<p>Image confidentiality is discussed in <a class="reference external" href="#boot-image-confidentiality-and-dpa">Boot Image Confidentiality and
DPA</a> section. In this section you
will modify the .bif file from the authentication section by adding
the attributes required to enable image confidentiality, using the
AES-256-GCM encryption algorithm. At the end, a Bootgen command will
be used to create all of the required AES-256 keys.</p>
<div class="section" id="using-aes-encryption">
<h4>Using AES Encryption<a class="headerlink" href="#using-aes-encryption" title="Permalink to this headline">¶</a></h4>
<ol>
<li><p>Enable image confidentiality by specifying the key source for the
initial encryption key (bbram_red_key for now) using the
[keysrc_encryption] <code class="docutils literal notranslate"><span class="pre">bbram_red_key</span></code> attribute.</p></li>
<li><p>On several of the partitions enable confidentiality by adding the
encryption = aes attribute of the partitions. Also specify a
unique key file for each partition. Having a unique key file for
each partition allows each partition to use a unique set of keys
which increases security strength by not reusing keys and reducing
the amount of information encrypted on any one key. The
<code class="docutils literal notranslate"><span class="pre">key_generation.bif</span></code> file should now look as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> ```
 the_ROM_image:
 {
 [pskfile]psk0.pem [sskfile]ssk0.pem
 [auth_params]spk_id = 0; ppk_select = 0 [keysrc_encryption]bbram_red_key
 [fsbl_config]a53_x64, bh_auth_enable
 [bootloader, authentication = rsa, encryption = aes, aeskeyfile = fsbl_a53.nky]fsbl_a53.elf
 [destination_cpu = pmu, authentication = rsa, encryption = aes, aeskeyfile = pmufw.nky]pmufw.elf
 [destination_device = pl, authentication = rsa, encryption = aes, aeskeyfile = edt_zcu102_wrapper.nky]edt_zcu102_wrapper.bit
 [destination_cpu = a53-0, exception_level = el-3, trustzone, authentication = rsa]bl31.elf
 [destination_cpu = r5-0, authentication = rsa, encryption = aes,aeskeyfile = tmr_psled_r5.nky]tmr_psled_r5.elf
 [destination_cpu = a53-0, exception_level = el-2, authentication = rsa]uboot.elf
 [load = 0x1000000, destination_cpu = a53-0, authentication = rsa]image.ub
 }
 ```
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="enabling-dpa-protections">
<h4>Enabling DPA Protections<a class="headerlink" href="#enabling-dpa-protections" title="Permalink to this headline">¶</a></h4>
<p>This section provides the steps to use an operational key and key
rolling effective countermeasures against the differential power
analysis (DPA).</p>
</div>
<div class="section" id="enable-use-of-an-operational-key">
<h4>Enable Use of an Operational Key<a class="headerlink" href="#enable-use-of-an-operational-key" title="Permalink to this headline">¶</a></h4>
<p>Use of an operational key limits the amount of information encrypted
using the device key. Enable use of the operational key by adding the
opt_key attribute to the [fsbl_config] line of the bif file. The
key_generation.bif file should now look like as shown below:</p>
<div class="highlight-the_ROM_image: notranslate"><div class="highlight"><pre><span></span>{
[pskfile]psk0.pem [sskfile]ssk0.pem
[auth_params]spk_id = 0; ppk_select = 0 [keysrc_encryption]bbram_red_key
[fsbl_config]a53_x64, bh_auth_enable, opt_key
[bootloader, authentication = rsa, encryption = aes, aeskeyfile = fsbl_a53.nky]fsbl_a53.elf
[destination_cpu = pmu, authentication = rsa, encryption = aes, aeskeyfile = pmufw.nky]pmufw.elf
[destination_device = pl, authentication = rsa, encryption = aes, aeskeyfile = edt_zcu102_wrapper.nky]edt_zcu102_wrapper.bit
[destination_cpu = a53-0, exception_level = el-3, trustzone, authentication = rsa]bl31.elf
[destination_cpu = r5-0, authentication = rsa, encryption = aes, aeskeyfile = tmr_psled_r5.nky]tmr_psled_r5.elf
[destination_cpu = a53-0, exception_level = el-2, authentication = rsa]uboot.elf
[load = 0x1000000, destination_cpu = a53-0, authentication = rsa]image.ub
}
</pre></div>
</div>
</div>
<div class="section" id="enabling-encryption-using-key-rolling">
<h4>Enabling Encryption Using Key Rolling<a class="headerlink" href="#enabling-encryption-using-key-rolling" title="Permalink to this headline">¶</a></h4>
<p>Use of key rolling limits the amount of information encrypted using
any of the other keys. Key- rolling is enabled on a
partition-by-partition basis using the blocks attribute in the bif
file. The blocks attribute allows specifying the amount of information
in bytes to encrypt with each key. For example,
blocks=4096,1024(3),512(*) would use the first key for 4096 bytes,
the second through fourth keys for 1024 bytes and all remaining keys
for 512 bytes. In this example, the block command will be used to
limit the life of each key to 1728 bytes.</p>
<p>Enable use of the key rolling by adding the blocks attribute to each
of the encrypted partitions. The key_generation.bif file should now
look as showbn below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">the_ROM_image</span><span class="p">:</span>
<span class="p">{</span>
<span class="p">[</span><span class="n">pskfile</span><span class="p">]</span><span class="n">psk0</span><span class="o">.</span><span class="n">pem</span>
<span class="p">[</span><span class="n">sskfile</span><span class="p">]</span><span class="n">ssk0</span><span class="o">.</span><span class="n">pem</span>
<span class="p">[</span><span class="n">auth_params</span><span class="p">]</span><span class="n">spk_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ppk_select</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">[</span><span class="n">keysrc_encryption</span><span class="p">]</span><span class="n">bbram_red_key</span>
<span class="p">[</span><span class="n">fsbl_config</span><span class="p">]</span><span class="n">a53_x64</span><span class="p">,</span> <span class="n">bh_auth_enable</span><span class="p">,</span> <span class="n">opt_key</span>
<span class="p">[</span><span class="n">bootloader</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">fsbl_a53</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">blocks</span> <span class="o">=</span> <span class="mi">1728</span><span class="p">(</span><span class="o">*</span><span class="p">)]</span><span class="n">fsbl_a53</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">pmu</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span><span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">pmufw</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">blocks</span> <span class="o">=</span> <span class="mi">1728</span><span class="p">(</span><span class="o">*</span><span class="p">)]</span><span class="n">pmufw</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_device</span> <span class="o">=</span> <span class="n">pl</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span><span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">edt_zcu102_wrapper</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">blocks</span> <span class="o">=</span> <span class="mi">1728</span><span class="p">(</span><span class="o">*</span><span class="p">)]</span><span class="n">edt_zcu102_wrapper</span><span class="o">.</span><span class="n">bit</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">trustzone</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">bl31</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">r5</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">tmr_psled_r5</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">blocks</span> <span class="o">=</span> <span class="mi">1728</span><span class="p">(</span><span class="o">*</span><span class="p">)]</span><span class="n">tmr_psled_r5</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">uboot</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">load</span> <span class="o">=</span> <span class="mh">0x1000000</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">image</span><span class="o">.</span><span class="n">ub</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="generating-all-of-the-aes-keys">
<h4>Generating All of the AES Keys<a class="headerlink" href="#generating-all-of-the-aes-keys" title="Permalink to this headline">¶</a></h4>
<p>Once all desired encryption features have been enabled, you can
generate all key files by running Bootgen. Some of the source files
(for example, ELF) contain multiple sections. These individual
sections will be mapped to separate partitions, and each partition
will have a unique key file. In this case, the key file will be
appended with a “.1.”. For example, if the <code class="docutils literal notranslate"><span class="pre">pmu_fw.elf</span></code> file contains
multiple sections, both a <code class="docutils literal notranslate"><span class="pre">pmu_fw.nky</span></code> and a <code class="docutils literal notranslate"><span class="pre">pmu_fw.1.nky</span></code> file will be
generated.</p>
<ol>
<li><p>Create all of the necessary NKY files by running the bootgen command
that creates the final <code class="docutils literal notranslate"><span class="pre">BOOT.bin</span></code> image.</p>
<p><code class="docutils literal notranslate"><span class="pre">bootgen</span> <span class="pre">-p</span> <span class="pre">zcu9eg</span> <span class="pre">-arch</span> <span class="pre">zynqmp</span> <span class="pre">-image</span> <span class="pre">key_generation.bif</span></code></p>
</li>
<li><p>Verify that the NKY files were generated. These file should include:</p>
<p><code class="docutils literal notranslate"><span class="pre">edt_zcu102_wrapper.nky,</span> <span class="pre">fsbl_a53.nky,</span> <span class="pre">pmu_fw.nky,</span> <span class="pre">pmu_fw.1.nky,</span> <span class="pre">pmu_fw.2.nky,</span> <span class="pre">tmr_psled_r5.nky,</span> <span class="pre">and</span> <span class="pre">tmr_psled_r5.1.nky.</span></code></p>
</li>
</ol>
</div>
</div>
</div>
<div class="section" id="using-key-revocation">
<h2>Using Key Revocation<a class="headerlink" href="#using-key-revocation" title="Permalink to this headline">¶</a></h2>
<p>Key revocation allows you to revoke a RSA primary or secondary public
key. Key revocation may be used due to elapsed time of key use or if
there is an indication that the key is compromised. The primary and
secondary key revocation is controlled by onetime programmable eFUSEs.
The Xilinx Secure Key Library is used for key revocation, allowing key
revocation in fielded devices. Key revocation is discussed further in
<em>Zynq UltraScale+ Device Technical Reference Manual</em>
(<a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/ndoc?t=user_guides%3Bd%3Dug1085-zynq-ultrascale-trm.pdf">UG1085</a>)</p>
<div class="section" id="using-the-puf">
<h3>Using the PUF<a class="headerlink" href="#using-the-puf" title="Permalink to this headline">¶</a></h3>
<p>In this section, the PUF is used for black key storage in the PUF
Bootheader mode. RSA authentication is required when the PUF is used.
In PUF Bootheader mode, the PUF helper data and the encrypted user’s
AES key are stored in the Bootheader. This section shows how to create
a BIF for using the PUF. Because the helper data and encrypted user
key will be unique for each and every board, the bootgen image created
will only work on the board from which the helper data originated.</p>
<p>At the end of the <a class="reference external" href="#secure-boot-sequence">Secure Boot Sequence</a>
section, a different BIF file demonstrates using the PUF in eFUSE
mode. In PUF eFUSe mode, the PUF helper data and encrypted user’s AES
key are stored in eFUSEs. In PUF eFUSE mode, a single boot image can
be used across all boards.</p>
</div>
<div class="section" id="puf-registration-in-bootheader-mode">
<h3>PUF Registration in Bootheader Mode<a class="headerlink" href="#puf-registration-in-bootheader-mode" title="Permalink to this headline">¶</a></h3>
<p>The PUF registration software is included in the XILSKEY library. The
PUF registration software operates in a bootheader mode or eFUSE mode.
The bootheader mode allows development without programming the OTP
eFUSEs. The eFUSE mode is used in production. This lab runs through
PUF registration in bootheader mode only. For PUF registration using
eFUSE, see <em>Programming BBRAM and eFUSEs</em>
(<a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/ndoc?t=application_notes%3Bd%3Dxapp1319-zynq-usp-prog-nvm.pdf">XAPP1319</a>).</p>
<p>The PUF registration software accepts a red (unencrypted) key as
input, and produces syndrome data (helper data), which also contains
CHASH and AUX, and a black (encrypted) key. When the PUF bootheader
mode is used, the output is put in the bootheader. When the PUF eFUSE
mode is used, the output is programmed into eFUSEs.</p>
<ol>
<li><p>In the Vitis IDE, navigate to tmr_psled_r5 Board Support Package Settings.</p></li>
<li><p>Ensure that xilskey and the xilsecure libraries are enabled.</p>
<p><img alt="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image80.png" src="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image80.png" /></p>
</li>
<li><p>Click <strong>OK</strong>. Re-build the hardware platform for changes to apply. Navigate to tmr_psled_r5_bsp settings.</p></li>
<li><p>Scroll to the Libraries section. Click <strong>xilskey 6.8 Import Examples</strong>.</p></li>
<li><p>In the view, select <strong>xilskey_puf_registration example</strong>. Click <strong>OK</strong>.</p>
<p><img alt="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image81.png" src="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image81.png" /></p>
</li>
<li><p>In the Project Explorer view, verify that the xilskey_puf_example_1 application is created.</p></li>
<li><p>In the Project Explorer view, xilskey_puf_example_1 ‘Src’, double-click <strong>xilskey_puf_registration.h</strong> to open in the Vitis IDE.</p></li>
<li><p>Edit xilskey_puf_registration.h as follows:</p>
<ol>
<li><p>Change #define XSK_PUF_INFO_ON_UART from FALSE to TRUE.</p></li>
<li><p>Ensure that #define XSK_PUF_PROGRAM_EFUSE is set to FALSE.</p></li>
<li><p>Set XSK_PUF_AES_KEY (256-bit key).</p>
<p>The key is to be entered in HEX format and should be Key 0 from the
fsbl_a53.nky file that you generated in <a class="reference external" href="#generating-all-of-the-aes-keys">Generating All of the AES Keys</a>. You can find a sample key
below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#define XSK_PUF_AES_KEY</span>
<span class="s2">&quot;68D58595279ED1481C674383583C1D98DA816202A57E7FE4F67859CB069CD510&quot;</span>
</pre></div>
</div>
<blockquote>
<div><p><strong><em>Note</em>:</strong> Do not copy this key. Refer to the fsbl_a53.nky file for
your key.</p>
</div></blockquote>
</li>
<li><p>Set the XSK_PUF_BLACK_KEY_IV. The initialization vector IV is a 12-byte data of your choice.</p>
<p><code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">XSK_PUF_BLACK_KEY_IV</span> <span class="pre">\&quot;E1757A6E6DD1CC9F733BED31\&quot;</span></code></p>
<p><img alt="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image82.png" src="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image82.png" /></p>
</li>
</ol>
</li>
<li><p>Save the file and exit.</p></li>
<li><p>In the Project Explorer view, right-click the
<strong>xilskey_puf_example_1</strong> project and select <strong>Build Project</strong>.</p></li>
<li><p>In the Vitis IDE, select <strong>Xilinx → Create Boot Image</strong>.</p></li>
<li><p>Select Zynq MP in the Architecture view.</p></li>
<li><p>Specify the bif path in the Output BIF file path view as <code class="docutils literal notranslate"><span class="pre">C:\edt\secureboot_sd\puf_registration\puf_registration.bif</span></code>.</p></li>
<li><p>Specify the output path in the Output Path view as
<code class="docutils literal notranslate"><span class="pre">C:\edt\secureboot_sd\puf_registration\BOOT.bin</span></code>.</p></li>
<li><p>In the Boot Image Partitions pane, click <strong>Add</strong>. Add the partitions
and set the destination CPU of the xilskey_puf_example_1
application to R5-0:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">fsbl_a53</span>\<span class="n">Debug</span>\<span class="n">fsbl_a53</span><span class="o">.</span><span class="n">elf</span>
<span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">xilskey_puf_example_1</span>\<span class="n">Debug</span>\<span class="n">xilskey_puf_example_1</span><span class="o">.</span><span class="n">elf</span>
</pre></div>
</div>
</li>
<li><p>Click <strong>Create Image</strong> to create the boot image for PUF
registration.</p>
<p><img alt="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image83.png" src="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image83.png" /></p>
</li>
<li><p>Insert an SD card into the PC SD card slot.</p></li>
<li><p>Copy <code class="docutils literal notranslate"><span class="pre">C:\edt\secureboot_sd\puf_registration\BOOT.bin</span></code> to the SD card.</p></li>
<li><p>Move the SD card from the PC SD card slot to the ZCU102 card slot.</p></li>
<li><p>Start a terminal session using Tera Term or Minicom depending on the
host machine being used, as well as the COM port and baud rate for
your system, as shown in .</p></li>
<li><p>In the communication terminal menu bar, select <strong>File→ Log</strong>. Enter
<code class="docutils literal notranslate"><span class="pre">C:\edt\secureboot_sd\puf_registration\puf_registration.log</span></code> in the view.</p></li>
<li><p>Power cycle the board.</p></li>
<li><p>After the puf_registration software has run, exit the communication
terminal.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">puf_registration.log</span></code> file is used in <a class="reference external" href="#using-puf-in-bootheader-mode">Using PUF in Bootheader
Mode</a>. Open <code class="docutils literal notranslate"><span class="pre">puf_registration.log</span></code> in a text editor.</p></li>
<li><p>Save the PUF Syndrome data that starts after App PUF Syndrome data
Start!!! and ends at PUF Syndrome data End!!!, non-inclusive, to
a file named <code class="docutils literal notranslate"><span class="pre">helperdata.txt</span></code>.</p></li>
<li><p>Save the black key IV identified by App: Black Key IV to a file
named <code class="docutils literal notranslate"><span class="pre">black_iv.txt</span></code>.</p></li>
<li><p>Save the black key to a file named <code class="docutils literal notranslate"><span class="pre">black_key.txt</span></code>.</p></li>
<li><p>The files <code class="docutils literal notranslate"><span class="pre">helperdata.txt</span></code>, <code class="docutils literal notranslate"><span class="pre">black_key.txt</span></code>, and <code class="docutils literal notranslate"><span class="pre">black_iv.txt</span></code> can be
saved in <code class="docutils literal notranslate"><span class="pre">C:\edt\secure_boot_sd\keys</span></code>.</p></li>
</ol>
<div class="section" id="using-puf-in-bootheader-mode">
<h4>Using PUF in Bootheader Mode<a class="headerlink" href="#using-puf-in-bootheader-mode" title="Permalink to this headline">¶</a></h4>
<p>The following steps describes the process to update the .bif file from
the previous sections to include using the PUF in Boot Header mode.
This section will make use of the Syndrome data and Black Key created
during PUF registration process.</p>
<ol>
<li><p>Enable use of the PUF by adding all of the fields and attributes
indicated in bold to the bif file (<code class="docutils literal notranslate"><span class="pre">key_generation.bif</span></code>) shown below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">the_ROM_image</span><span class="p">:</span>
<span class="p">{</span>
<span class="p">[</span><span class="n">pskfile</span><span class="p">]</span><span class="n">psk0</span><span class="o">.</span><span class="n">pem</span>
<span class="p">[</span><span class="n">sskfile</span><span class="p">]</span><span class="n">ssk0</span><span class="o">.</span><span class="n">pem</span>
<span class="p">[</span><span class="n">auth_params</span><span class="p">]</span><span class="n">spk_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ppk_select</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">[</span><span class="n">keysrc_encryption</span><span class="p">]</span><span class="n">bh_blk_key</span>
<span class="p">[</span><span class="n">bh_key_iv</span><span class="p">]</span><span class="n">black_iv</span><span class="o">.</span><span class="n">txt</span>
<span class="p">[</span><span class="n">bh_keyfile</span><span class="p">]</span><span class="n">black_key</span><span class="o">.</span><span class="n">txt</span>
<span class="p">[</span><span class="n">puf_file</span><span class="p">]</span><span class="n">helperdata</span><span class="o">.</span><span class="n">txt</span>
<span class="p">[</span><span class="n">fsbl_config</span><span class="p">]</span><span class="n">a53_x64</span><span class="p">,</span> <span class="n">bh_auth_enable</span><span class="p">,</span> <span class="n">opt_key</span><span class="p">,</span> <span class="n">puf4kmode</span><span class="p">,</span> <span class="n">shutter</span><span class="o">=</span><span class="mh">0x0100005E</span><span class="p">,</span><span class="n">pufhd_bh</span>
<span class="p">[</span><span class="n">bootloader</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">fsbl_a53</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">blocks</span> <span class="o">=</span> <span class="mi">1728</span><span class="p">(</span><span class="o">*</span><span class="p">)]</span><span class="n">fsbl_a53</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">pmu</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">pmufw</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">blocks</span> <span class="o">=</span> <span class="mi">1728</span><span class="p">(</span><span class="o">*</span><span class="p">)]</span><span class="n">pmufw</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_device</span> <span class="o">=</span> <span class="n">pl</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">edt_zcu102_wrapper</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">blocks</span> <span class="o">=</span> <span class="mi">1728</span><span class="p">(</span><span class="o">*</span><span class="p">)]</span><span class="n">edt_zcu102_wrapper</span><span class="o">.</span><span class="n">bit</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">trustzone</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">bl31</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">r5</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">tmr_psled_r5</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">blocks</span> <span class="o">=</span><span class="mi">1728</span><span class="p">(</span><span class="o">*</span><span class="p">)]</span><span class="n">tmr_psled_r5</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">uboot</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">load</span> <span class="o">=</span> <span class="mh">0x1000000</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">]</span><span class="n">image</span><span class="o">.</span><span class="n">ub</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>The above .bif file can be used for creating a final boot image
using an AES key encrypted in the boot image header with the PUF
KEK. This would be done using the following bootgen command.</p>
<p><code class="docutils literal notranslate"><span class="pre">bootgen</span> <span class="pre">-p</span> <span class="pre">zcu9eg</span> <span class="pre">-arch</span> <span class="pre">zynqmp</span> <span class="pre">-image</span> <span class="pre">key_generation.bif</span> <span class="pre">-w</span> <span class="pre">-o</span> <span class="pre">BOOT.bin</span></code></p>
</li>
</ol>
<blockquote>
<div><p><strong><em>Note</em>:</strong> The above steps can also be executed with PUF in eFUSE
mode. In this case you can repeat the previous steps, using the PUF in
eFUSE mode. This requires enabling the programming of eFUSEs during
PUF registration by setting the XSK_PUF_PROGRAM_EFUSE macro in the
xilskey_puf_registration.h file used to build the PUF registration
application. Also, the BIF would need to be modified to use the
encryption key from eFUSE and removing the helper data and black key
files. PUF in eFUSE mode is not covered in this tutorial to avoid
programming the eFUSEs on development or tutorial systems.</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">keysrc_encryption</span><span class="p">]</span><span class="n">efuse_blk_key</span>
<span class="p">[</span><span class="n">bh_key_iv</span><span class="p">]</span><span class="n">black_iv</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</div>
<div class="section" id="system-example-using-the-vitis-ide-create-boot-image-wizard">
<h4>System Example Using the Vitis IDE Create Boot Image Wizard<a class="headerlink" href="#system-example-using-the-vitis-ide-create-boot-image-wizard" title="Permalink to this headline">¶</a></h4>
<p>The prior sections enabled the various security features
(authentication, confidentiality, DPA protections, and black key
storage) by hand editing the BIF file. This section performs the same
operations, but uses the Bootgen Wizard as a starting point. The
Bootgen Wizard creates a base BIF file, and then adds the additional
security features that are not supported by the wizard using a text
editor.</p>
<ol>
<li><p>Change directory to the bootgen_files directory.</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">C:\edt\secure_boot_sd\bootgen_files</span></code></p>
</li>
<li><p>Copy the below data from the prior example to this example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">../</span><span class="n">keys</span><span class="o">/*</span><span class="n">nky</span> <span class="o">.</span>
<span class="n">cp</span> <span class="o">../</span><span class="n">keys</span><span class="o">/*</span><span class="n">pem</span> <span class="o">.</span>
<span class="n">cp</span> <span class="o">../</span><span class="n">keys</span><span class="o">/</span><span class="n">black_iv</span><span class="o">.</span><span class="n">txt</span> <span class="o">.</span>
<span class="n">cp</span> <span class="o">../</span><span class="n">keys</span><span class="o">/</span><span class="n">helperdata</span><span class="o">.</span><span class="n">txt</span> <span class="o">.</span>
<span class="n">cp</span> <span class="o">../</span><span class="n">keys</span><span class="o">/*.</span><span class="n">elf</span> <span class="o">.</span>
<span class="n">cp</span> <span class="o">../</span><span class="n">keys</span><span class="o">/</span><span class="n">edt_zcu102_wrapper</span><span class="o">.</span><span class="n">bit</span> <span class="o">.</span>
<span class="n">cp</span> <span class="o">../</span><span class="n">keys</span><span class="o">/</span><span class="n">image</span><span class="o">.</span><span class="n">ub</span> <span class="o">.</span>
<span class="n">cp</span> <span class="o">../</span><span class="n">keys</span><span class="o">/</span><span class="n">black_key</span><span class="o">.</span><span class="n">txt</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p>Click <strong>Programs→ Xilinx Design Tools → Vitis 2020.1 → Xilinx Vitis 2020.1</strong> to launch the Vitis IDE.</p></li>
<li><p>Click <strong>Xilinx Tools → Create Boot Image</strong> from the menu bar to
launch the Create Boot Image wizard.</p></li>
<li><p>Select Zynq MP as the Architecture.</p></li>
<li><p>Enter the Output BIF file path as <code class="docutils literal notranslate"><span class="pre">C:\edt\secure_boot_sd\bootgen_files\design_bh_bkey_keyrolling.bif</span></code>.</p></li>
<li><p>Select BIN as the output format.</p></li>
<li><p>Enter the output path <code class="docutils literal notranslate"><span class="pre">C:\edt\secure_boot_sd\bootgen_files\BOOT.bin</span></code>.</p></li>
<li><p>Enable authentication.</p>
<ol>
<li><p>Click the <strong>Security</strong> page.</p></li>
<li><p>Check the Use Authentication check box.</p></li>
<li><p>Browse to select the <code class="docutils literal notranslate"><span class="pre">psk0.pem</span></code> file for the PSK and the <code class="docutils literal notranslate"><span class="pre">ssk0.pem</span></code> for the SSK.</p></li>
<li><p>Ensure PPK select is 0.</p></li>
<li><p>Enter SPK ID as 0.</p></li>
<li><p>Check the Use BH Auth check box.</p>
<p><img alt="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image84.jpeg" src="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image84.jpeg" /></p>
</li>
</ol>
</li>
<li><p>Enable encryption.</p>
<ol>
<li><p>Click the <strong>Encryption</strong> page.</p></li>
<li><p>Check the Use Encryption check box.</p></li>
<li><p>Provide the part name as <strong>zcu9eg</strong>.</p></li>
<li><p>Check the Operational Key check box.</p>
<p><img alt="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image85.png" src="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image85.png" /></p>
</li>
</ol>
</li>
<li><p>Click the <strong>Basic</strong> page.</p></li>
<li><p>Add the FSBL binary to the boot image.</p>
<ol>
<li><p>Click Add.</p></li>
<li><p>Use the browse button to select the fsbl_a53.elf file.</p></li>
<li><p>Make sure the partition-type is bootloader and the destination CPU is a53x64.</p></li>
<li><p>Change authentication to RSA</p></li>
<li><p>Change encryption to AES.</p></li>
<li><p>Browse the fsbl_a53.nky file that was generated earlier and add the Key file.</p></li>
<li><p>Click <strong>OK</strong>.</p>
<p><img alt="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image86.png" src="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image86.png" /></p>
</li>
</ol>
</li>
<li><p>Add the PMU firmware binary to the boot image.</p>
<ol>
<li><p>Click <strong>Add</strong>.</p></li>
<li><p>Use the browse button to select the pmufw.elf file.</p></li>
<li><p>Make sure the partition-type is datafile.</p></li>
<li><p>Change the destination CPU to PMU.</p></li>
<li><p>Change authentication to RSA.</p></li>
<li><p>Change encryption to AES.</p></li>
<li><p>Add pmufw.nky file as the key file.</p></li>
<li><p>Click <strong>OK</strong>.</p>
<p><img alt="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image87.png" src="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image87.png" /></p>
</li>
</ol>
</li>
<li><p>Add the PL Bitstream to the boot image.</p>
<ol>
<li><p>Click the <strong>Add</strong>.</p></li>
<li><p>Use the browse button to select the edt_zcu102_wrapper.bit file.</p></li>
<li><p>Make sure the partition-type is datafile.</p></li>
<li><p>Make sure the destination device is PL.</p></li>
<li><p>Change authentication to RSA.</p></li>
<li><p>Change encryption to AES.</p></li>
<li><p>Add edt_zcu102_wrapper.bit file in the key file.</p></li>
<li><p>Click <strong>OK</strong>.</p>
<p><img alt="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image88.png" src="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image88.png" /></p>
</li>
</ol>
</li>
<li><p>Add the Arm Trusted Firmware (ATF) binary to the image.</p>
<ol>
<li><p>Click <strong>Add</strong>.</p></li>
<li><p>Use the browse button to select the bl31.elf file.</p></li>
<li><p>Make sure the partition-type is datafile.</p></li>
<li><p>Make sure the destination CPU is A53 0.</p></li>
<li><p>Change authentication to RSA.</p></li>
<li><p>Make sure the encryption is none.</p></li>
<li><p>Make sure the Exception Level is EL3 and enable TrustZone.</p></li>
<li><p>Click <strong>OK</strong>.</p>
<p><img alt="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image89.png" src="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image89.png" /></p>
</li>
</ol>
</li>
<li><p>Add the R5 software binary to the boot image.</p>
<ol>
<li><p>Click <strong>Add</strong>.</p></li>
<li><p>Use the browse button to select the <code class="docutils literal notranslate"><span class="pre">tmr_psled_r5.elf</span></code> file</p></li>
<li><p>Make sure the partition-type is datafile.</p></li>
<li><p>Make sure the destination CPU is R5 0.</p></li>
<li><p>Change authentication to RSA.</p></li>
<li><p>Change encryption to AES.</p></li>
<li><p>Add the <code class="docutils literal notranslate"><span class="pre">tmr_psled_r5.nky</span></code> file in the key file.</p></li>
<li><p>Click <strong>OK</strong>.</p>
<p><img alt="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image90.png" src="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image90.png" /></p>
</li>
</ol>
</li>
<li><p>Add the U-Boot software binary to the boot image.</p>
<p>a.  Click <strong>Add</strong>.</p>
<p>b.  Use the browse button to select the u-boot.elf file.</p>
<p>c.  Make sure the partition-type is datafile.</p>
<p>d.  Make sure the destination CPU is A53 0.</p>
<p>e.  Change authentication to RSA.</p>
<p>f.  Make sure that encryption is none.</p>
<p>g.  Change the Exception Level to EL2.</p>
<p>h.  Click <strong>OK</strong>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>![](./media/image91.png)
</pre></div>
</div>
</li>
<li><p>Add the Linux image to the boot image.</p>
<ol>
<li><p>Click <strong>Add</strong>.</p></li>
<li><p>Use the browse button to select the <code class="docutils literal notranslate"><span class="pre">image.ub</span></code> file.</p></li>
<li><p>Make sure the partition-type is datafile.</p></li>
<li><p>Make sure the destination CPU is A53 0.</p></li>
<li><p>Change authentication to RSA.</p></li>
<li><p>Make sure that encryption is none.</p></li>
<li><p>Update the load field to <code class="docutils literal notranslate"><span class="pre">0x2000000</span></code>.</p></li>
<li><p>Click <strong>OK</strong>.</p>
<p><img alt="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image92.png" src="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image92.png" /></p>
</li>
</ol>
</li>
<li><p>Click <strong>Create image</strong>.</p>
<p><img alt="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image93.png" src="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image93.png" /></p>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">design_bh_bkey_keyrolling.bif</span></code> file should look similar to the
following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">arch</span> <span class="o">=</span> <span class="n">zynqmp</span><span class="p">;</span> <span class="n">split</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span> <span class="nb">format</span> <span class="o">=</span> <span class="n">BIN</span><span class="p">;</span> <span class="n">key_part_name</span> <span class="o">=</span> <span class="n">zcu9eg</span>
<span class="n">the_ROM_image</span><span class="p">:</span>
<span class="p">{</span>
<span class="p">[</span><span class="n">pskfile</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">psk0</span><span class="o">.</span><span class="n">pem</span>
<span class="p">[</span><span class="n">sskfile</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">ssk0</span><span class="o">.</span><span class="n">pem</span>
<span class="p">[</span><span class="n">auth_params</span><span class="p">]</span><span class="n">spk_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ppk_select</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">[</span><span class="n">keysrc_encryption</span><span class="p">]</span><span class="n">efuse_red_key</span>
<span class="p">[</span><span class="n">fsbl_config</span><span class="p">]</span><span class="n">bh_auth_enable</span><span class="p">,</span> <span class="n">opt_key</span>
<span class="p">[</span><span class="n">bootloader</span><span class="p">,</span> <span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">fsbl_a53</span><span class="o">.</span><span class="n">nky</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>
\<span class="n">bootgen_files</span>\<span class="n">fsbl_a53</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">pmufw</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">pmu</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">pmufw</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">edt_zcu102_wrapper</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">destination_device</span> <span class="o">=</span> <span class="n">pl</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">edt_zcu102_wrapper</span><span class="o">.</span><span class="n">bit</span>
<span class="p">[</span><span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">trustzone</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">bl31</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">tmr_psled_r5</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span>
<span class="n">r5</span><span class="o">-</span><span class="mi">0</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">tmr_psled_r5</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">u</span><span class="o">-</span><span class="n">boot</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">load</span> <span class="o">=</span> <span class="mh">0x2000000</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">image</span><span class="o">.</span><span class="n">ub</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>This BIF file is still missing several security features that are
not supported by the Create Boot Image wizard. These are features
are key rolling and black key store.</p></li>
<li><p>Add black key store by changing the keysrc_encryption and adding the
other additional items so that the BIF file looks like the
following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">the_ROM_image</span><span class="p">:</span>
<span class="p">{</span>
<span class="p">[</span><span class="n">pskfile</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">psk0</span><span class="o">.</span><span class="n">pem</span>
<span class="p">[</span><span class="n">sskfile</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">ssk0</span><span class="o">.</span><span class="n">pem</span>
<span class="p">[</span><span class="n">auth_params</span><span class="p">]</span><span class="n">spk_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ppk_select</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">[</span><span class="n">keysrc_encryption</span><span class="p">]</span><span class="n">bh_blk_key</span>
<span class="p">[</span><span class="n">bh_key_iv</span><span class="p">]</span><span class="n">black_iv</span><span class="o">.</span><span class="n">txt</span>
<span class="p">[</span><span class="n">bh_keyfile</span><span class="p">]</span><span class="n">black_key</span><span class="o">.</span><span class="n">txt</span>
<span class="p">[</span><span class="n">puf_file</span><span class="p">]</span><span class="n">helperdata</span><span class="o">.</span><span class="n">txt</span>
<span class="p">[</span><span class="n">fsbl_config</span><span class="p">]</span><span class="n">a53_x64</span><span class="p">,</span> <span class="n">bh_auth_enable</span><span class="p">,</span> <span class="n">opt_key</span><span class="p">,</span><span class="n">puf4kmode</span><span class="p">,</span><span class="n">shutter</span><span class="o">=</span><span class="mh">0x0100005E</span><span class="p">,</span><span class="n">pufhd_bh</span>
<span class="p">[</span><span class="n">bootloader</span><span class="p">,</span> <span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">fsbl_a53</span><span class="o">.</span><span class="n">nky</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>
\<span class="n">bootgen_files</span>\<span class="n">fsbl_a53</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">pmufw</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">pmu</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>
\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">pmufw</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">edt_zcu102_wrapper</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">destination_device</span>
<span class="o">=</span> <span class="n">pl</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">edt_zcu102_wrapper</span><span class="o">.</span><span class="n">bit</span>
<span class="p">[</span><span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">trustzone</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">bl31</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">tmr_psled_r5</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span>
<span class="n">r5</span><span class="o">-</span><span class="mi">0</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">tmr_psled_r5</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">u</span><span class="o">-</span><span class="n">boot</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">load</span> <span class="o">=</span> <span class="mh">0x2000000</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">image</span><span class="o">.</span><span class="n">ub</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Enable key rolling by adding the block attributes to the encrypted
partitions. The updated BIF file should now look like the
following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">arch</span> <span class="o">=</span> <span class="n">zynqmp</span><span class="p">;</span> <span class="n">split</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span> <span class="nb">format</span> <span class="o">=</span> <span class="n">BIN</span><span class="p">;</span> <span class="n">key_part_name</span> <span class="o">=</span> <span class="n">zcu9eg</span>
<span class="n">the_ROM_image</span><span class="p">:</span>
<span class="p">{</span>
<span class="p">[</span><span class="n">pskfile</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">psk0</span><span class="o">.</span><span class="n">pem</span>
<span class="p">[</span><span class="n">sskfile</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">ssk0</span><span class="o">.</span><span class="n">pem</span>
<span class="p">[</span><span class="n">auth_params</span><span class="p">]</span><span class="n">spk_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ppk_select</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">[</span><span class="n">keysrc_encryption</span><span class="p">]</span><span class="n">bh_blk_key</span>
<span class="p">[</span><span class="n">bh_key_iv</span><span class="p">]</span><span class="n">black_iv</span><span class="o">.</span><span class="n">txt</span>
<span class="p">[</span><span class="n">bh_keyfile</span><span class="p">]</span><span class="n">black_key</span><span class="o">.</span><span class="n">txt</span>
<span class="p">[</span><span class="n">puf_file</span><span class="p">]</span><span class="n">helperdata</span><span class="o">.</span><span class="n">txt</span>
<span class="p">[</span><span class="n">fsbl_config</span><span class="p">]</span><span class="n">a53_x64</span><span class="p">,</span> <span class="n">bh_auth_enable</span><span class="p">,</span> <span class="n">opt_key</span><span class="p">,</span> <span class="n">puf4kmode</span><span class="p">,</span><span class="n">shutter</span><span class="o">=</span><span class="mh">0x0100005E</span><span class="p">,</span><span class="n">pufhd_bh</span>
<span class="p">[</span><span class="n">bootloader</span><span class="p">,</span> <span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">fsbl_a53</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">blocks</span> <span class="o">=</span> <span class="mi">1728</span><span class="p">(</span><span class="o">*</span><span class="p">)]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>
\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">fsbl_a53</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">pmufw</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">pmu</span><span class="p">,</span> <span class="n">blocks</span> <span class="o">=</span>
<span class="mi">1728</span><span class="p">(</span><span class="o">*</span><span class="p">)]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">pmufw</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">edt_zcu102_wrapper</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">destination_device</span>
<span class="o">=</span> <span class="n">pl</span><span class="p">,</span> <span class="n">blocks</span> <span class="o">=</span> <span class="mi">1728</span><span class="p">(</span><span class="o">*</span><span class="p">)]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>
\<span class="n">edt_zcu102_wrapper</span><span class="o">.</span><span class="n">bit</span>
<span class="p">[</span><span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">trustzone</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">bl31</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">tmr_psled_r5</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">r5</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span>
<span class="n">blocks</span> <span class="o">=</span> <span class="mi">1728</span><span class="p">(</span><span class="o">*</span><span class="p">)]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">tmr_psled_r5</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">u</span><span class="o">-</span><span class="n">boot</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">load</span> <span class="o">=</span> <span class="mh">0x2000000</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">image</span><span class="o">.</span><span class="n">ub</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Generate the boot image by running the following command. Note that
the <code class="docutils literal notranslate"><span class="pre">-</span> <span class="pre">encryption_dump</span></code> flag has been added. This flag causes the
log file <code class="docutils literal notranslate"><span class="pre">aes_log.txt</span></code> to be created. The log file details all
encryption operations that were used. This allows you to see which
keys and IVs were used on which sections of the boot image.</p>
<p><code class="docutils literal notranslate"><span class="pre">bootgen</span> <span class="pre">-p</span> <span class="pre">zcu9eg</span> <span class="pre">-arch</span> <span class="pre">zynqmp</span> <span class="pre">-image</span> <span class="pre">design_bh_bkey_keyrolling.bif</span> <span class="pre">-w</span> <span class="pre">-o</span> <span class="pre">BOOT.bin</span> <span class="pre">-encryption_dump</span></code></p>
</li>
</ol>
</div>
</div>
<div class="section" id="booting-the-system-using-a-secure-boot-image">
<h3>Booting the System Using a Secure Boot Image<a class="headerlink" href="#booting-the-system-using-a-secure-boot-image" title="Permalink to this headline">¶</a></h3>
<p>This section demonstrates how to use the BOOT.bin boot image created
in prior sections to perform a secure boot using the ZCU102.</p>
<ol>
<li><p>Copy the BOOT.bin image, boot.scr which is generated in PetaLinux
and the <code class="docutils literal notranslate"><span class="pre">ps_pl_linux_app.elf</span></code> file.</p></li>
<li><p>Insert the SD card into the ZCU102.</p></li>
<li><p>Set SW6 of the ZCU102 for SD boot mode (1=ON; 2,3,4=OFF).</p>
<p><img alt="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image43.jpeg" src="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image43.jpeg" /></p>
</li>
<li><p>Connect Serial terminals to ZCU102 (115200, 8 data bits, 1 stop bit,
no parity).</p></li>
<li><p>Power on the ZCU102.</p></li>
<li><p>When the terminal reaches the U-Boot ZynqMP\ prompt, type bootm 0x2000000.</p>
<p><img alt="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image94.png" src="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image94.png" /></p>
</li>
<li><p>Login into Linux using the following credentials:</p>
<p>Login: root;
password: root</p>
<p>Run the Linux Application as described in <a class="reference external" href="7-system-design-examples.md#design-example-1-using-gpios-timers-and-interrupts">Design Example 1: Using
GPIOs, Timers, and Interrupts</a></p>
<p><img alt="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image95.png" src="ZynqMPSoC-EDT\docs\featured-tutorials\./media/image95.png" /></p>
</li>
</ol>
</div>
<div class="section" id="running-the-linux-application">
<h3>Running the Linux Application<a class="headerlink" href="#running-the-linux-application" title="Permalink to this headline">¶</a></h3>
<p>Use the following steps to run a Linux application:</p>
<ol>
<li><p>Copy the application from SD card mount point to <code class="docutils literal notranslate"><span class="pre">/tmp</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">cp</span> <span class="pre">/run/media/mmcblk0p1/ps_pl_linux_app.elf</span> <span class="pre">/tmp</span></code></p>
<blockquote>
<div><p><strong><em>Note</em>:</strong> Mount the SD card manually if you fail to find SD card
contents in this location.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">mount</span> <span class="pre">/dev/mmcblk0p1</span> <span class="pre">/media/</span></code></p>
</li>
<li><p>Copy the application to /tmp.</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">cp</span> <span class="pre">/media/ps_pl_linux_app.elf</span> <span class="pre">/tmp</span></code></p>
</li>
<li><p>Run the application.</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">/tmp/ps_pl_linux_app.elf</span></code></p>
</li>
</ol>
</div>
<div class="section" id="sample-bif-for-a-fielded-system">
<h3>Sample BIF for a Fielded System<a class="headerlink" href="#sample-bif-for-a-fielded-system" title="Permalink to this headline">¶</a></h3>
<p>The following BIF file is an example for a fielded system. In order
for this bif file to work on a board it requires the RSA_EN, PPK0
Digest, black AES key and PUF helper data to all be programmed in the
eFUSEs. Because programming these eFUSEs severely limits the use of
the device or board for testing and debugging, it is only included
here as a reference. It is not part of the tutorial.</p>
<p>The following changes are made to the final <code class="docutils literal notranslate"><span class="pre">generation.bif</span></code> file reach
the following result:</p>
<ol class="simple">
<li><p>Change from PUF Bootheader mode to PUF eFUSE mode.</p>
<ol class="simple">
<li><p>Change the keysrc_encryption attribute to efuse_blk_key.</p></li>
<li><p>Remove the bh_keyfile and puf_file lines.</p></li>
<li><p>Remove the puf4kmode and pufhd_bh attributes from the fsbl_config line.</p></li>
</ol>
</li>
<li><p>Change from boot header authentication to eFUSE authentication. Remove the bh_auth_enable attribute from the fsbl_config line.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">arch</span> <span class="o">=</span> <span class="n">zynqmp</span><span class="p">;</span> <span class="n">split</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span> <span class="nb">format</span> <span class="o">=</span> <span class="n">BIN</span><span class="p">;</span> <span class="n">key_part_name</span> <span class="o">=</span> <span class="n">zcu9eg</span>
<span class="n">the_ROM_image</span><span class="p">:</span>
<span class="p">{</span>
<span class="p">[</span><span class="n">pskfile</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">psk0</span><span class="o">.</span><span class="n">pem</span>
<span class="p">[</span><span class="n">sskfile</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">ssk0</span><span class="o">.</span><span class="n">pem</span>
<span class="p">[</span><span class="n">auth_params</span><span class="p">]</span><span class="n">spk_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ppk_select</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">[</span><span class="n">keysrc_encryption</span><span class="p">]</span><span class="n">bh_blk_key</span>
<span class="p">[</span><span class="n">bh_key_iv</span><span class="p">]</span><span class="n">black_iv</span><span class="o">.</span><span class="n">txt</span>
<span class="p">[</span><span class="n">bh_keyfile</span><span class="p">]</span><span class="n">black_key</span><span class="o">.</span><span class="n">txt</span>
<span class="p">[</span><span class="n">puf_file</span><span class="p">]</span><span class="n">helperdata</span><span class="o">.</span><span class="n">txt</span>
<span class="p">[</span><span class="n">fsbl_config</span><span class="p">]</span><span class="n">a53_x64</span><span class="p">,</span> <span class="n">bh_auth_enable</span><span class="p">,</span> <span class="n">opt_key</span><span class="p">,</span> <span class="n">puf4kmode</span><span class="p">,</span><span class="n">shutter</span><span class="o">=</span><span class="mh">0x0100005E</span><span class="p">,</span><span class="n">pufhd_bh</span>
<span class="p">[</span><span class="n">bootloader</span><span class="p">,</span> <span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">fsbl_a53</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">blocks</span> <span class="o">=</span> <span class="mi">1728</span><span class="p">(</span><span class="o">*</span><span class="p">)]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>
\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">fsbl_a53</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">pmufw</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">pmu</span><span class="p">,</span> <span class="n">blocks</span> <span class="o">=</span>
<span class="mi">1728</span><span class="p">(</span><span class="o">*</span><span class="p">)]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">pmufw</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">edt_zcu102_wrapper</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">destination_device</span>
<span class="o">=</span> <span class="n">pl</span><span class="p">,</span> <span class="n">blocks</span> <span class="o">=</span> <span class="mi">1728</span><span class="p">(</span><span class="o">*</span><span class="p">)]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>
\<span class="n">edt_zcu102_wrapper</span><span class="o">.</span><span class="n">bit</span>
<span class="p">[</span><span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">trustzone</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">bl31</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">encryption</span> <span class="o">=</span> <span class="n">aes</span><span class="p">,</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">aeskeyfile</span> <span class="o">=</span> <span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">tmr_psled_r5</span><span class="o">.</span><span class="n">nky</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">r5</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span>
<span class="n">blocks</span> <span class="o">=</span> <span class="mi">1728</span><span class="p">(</span><span class="o">*</span><span class="p">)]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">tmr_psled_r5</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="n">exception_level</span> <span class="o">=</span> <span class="n">el</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">u</span><span class="o">-</span><span class="n">boot</span><span class="o">.</span><span class="n">elf</span>
<span class="p">[</span><span class="n">authentication</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">load</span> <span class="o">=</span> <span class="mh">0x2000000</span><span class="p">,</span> <span class="n">destination_cpu</span> <span class="o">=</span> <span class="n">a53</span><span class="o">-</span><span class="mi">0</span><span class="p">]</span><span class="n">C</span><span class="p">:</span>\<span class="n">edt</span>\<span class="n">secure_boot_sd</span>\<span class="n">bootgen_files</span>\<span class="n">image</span><span class="o">.</span><span class="n">ub</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="debugging-problems-with-secure-boot">
<h1>Debugging Problems with Secure Boot<a class="headerlink" href="#debugging-problems-with-secure-boot" title="Permalink to this headline">¶</a></h1>
<p>This appendix describes how to debug security failures. One procedure
determines if PUF registration has been run on the device. A second
procedure checks the value of the Boot Header in the boot image.</p>
<div class="section" id="determine-if-puf-registration-is-running">
<h2>Determine if PUF Registration is Running<a class="headerlink" href="#determine-if-puf-registration-is-running" title="Permalink to this headline">¶</a></h2>
<p>The following steps can be used to verify if the PUF registration
software has been run on the device:</p>
<ol>
<li><p>In the Vitis IDE, select <strong>Xilinx → XSCT Console</strong>.</p></li>
<li><p>Enter the following commands at the prompt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xsct</span><span class="o">%</span> <span class="n">connect</span>
<span class="n">xsct</span><span class="o">%</span> <span class="n">targets</span>
<span class="n">xsct</span><span class="o">%</span> <span class="n">targets</span> <span class="o">-</span><span class="nb">set</span> <span class="o">-</span><span class="nb">filter</span> <span class="p">{</span><span class="n">name</span> <span class="o">=~</span> <span class="s2">&quot;Cortex-A53 #0&quot;</span><span class="p">}</span>
<span class="n">xsct</span><span class="o">%</span> <span class="n">rst</span> <span class="o">-</span><span class="n">processor</span>
<span class="n">xsct</span><span class="o">%</span> <span class="n">mrd</span> <span class="o">-</span><span class="n">force</span> <span class="mh">0xFFCC1050</span> <span class="p">(</span><span class="mh">0xFFCC1054</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>This location contains the CHASH and AUX values. If non-zero, PUF
registration software has been run on the device.</p></li>
</ol>
</div>
<div class="section" id="read-the-boot-image">
<h2>Read the Boot Image<a class="headerlink" href="#read-the-boot-image" title="Permalink to this headline">¶</a></h2>
<p>You can use the Bootgen Utility to verify the header values and the
partition data used in the Boot Image.</p>
<ol>
<li><p>Change to the directory containing BOOT.bin.</p></li>
<li><p>From an XSCT prompt, run the following command.</p>
<p><code class="docutils literal notranslate"><span class="pre">bootgen_utility</span> <span class="pre">--bin</span> <span class="pre">BOOT.bin</span> <span class="pre">--out</span> <span class="pre">myfile</span> <span class="pre">--arch</span> <span class="pre">zynqmp</span></code></p>
</li>
<li><p>Look for “BH” in myfile.</p></li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on January 19, 2021.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2020, Xilinx
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>